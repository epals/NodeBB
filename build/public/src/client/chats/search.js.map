{"version":3,"sources":["public/src/client/chats/search.js"],"names":["define","components","api","search","init","timeoutId","get","on","clearTimeout","setTimeout","doSearch","username","val","$","empty","query","searchBy","paginate","then","displayResults","catch","app","alertError","data","chatsListEl","users","filter","user","parseInt","uid","length","translateHtml","forEach","userObj","chatEl","displayUser","onUserClick","parent","toggleClass","createUserImage","picture","status","attr","appendTo","append","socket","emit","err","roomId","message","require","chats","switchChat","newChat"],"mappings":"AAAA,aAGAA,OAAO,sBAAuB,aAAc,OAAQ,SAAUC,EAAYC,GACzE,IAAIC,KAEJA,EAAOC,KAAO,WACb,IAAIC,EAAY,EAEhBJ,EAAWK,IAAI,eAAeC,GAAG,QAAS,WACzC,GAAIF,EAAW,CACdG,aAAaH,GACbA,EAAY,EAGbA,EAAYI,WAAWC,EAAU,QAInC,SAASA,IACR,IAAIC,EAAWV,EAAWK,IAAI,eAAeM,MAC7C,IAAKD,EAAU,CACd,OAAOE,EAAE,kCAAkCC,QAG5CZ,EAAII,IAAI,cACPS,MAAOJ,EACPK,SAAU,WACVC,SAAU,QACRC,KAAKC,GACNC,MAAMC,IAAIC,YAGb,SAASH,EAAeI,GACvB,IAAIC,EAAcX,EAAE,kCACpBW,EAAYV,QAEZS,EAAKE,MAAQF,EAAKE,MAAMC,OAAO,SAAUC,GACxC,OAAOC,SAASD,EAAKE,IAAK,MAAQD,SAASP,IAAIM,KAAKE,IAAK,MAG1D,IAAKN,EAAKE,MAAMK,OAAQ,CACvB,OAAON,EAAYO,cAAc,6DAGlCR,EAAKE,MAAMO,QAAQ,SAAUC,GAC5B,IAAIC,EAASC,EAAYX,EAAaS,GACtCG,EAAYF,EAAQD,KAGrBT,EAAYa,SAASC,YAAY,OAAQ,MAG1C,SAASH,EAAYX,EAAaS,GACjC,SAASM,IACR,OAAQN,EAAQO,QACf,aAAeP,EAAQO,QAAU,YAAcP,EAAQtB,SAAW,OAClE,mDAAqDsB,EAAQ,gBAAkB,KAAOA,EAAQ,aAAe,UAC7G,iCAAmCA,EAAQQ,OAAS,UAAYR,EAAQtB,SAG1E,IAAIuB,EAASrB,EAAE,0CACb6B,KAAK,WAAYT,EAAQJ,KACzBc,SAASnB,GAEXU,EAAOU,OAAOL,KACd,OAAOL,EAGR,SAASE,EAAYF,EAAQD,GAC5BC,EAAO3B,GAAG,QAAS,WAClBsC,OAAOC,KAAK,+BAAgCb,EAAQJ,IAAK,SAAUkB,EAAKC,GACvE,GAAID,EAAK,CACR,OAAO1B,IAAIC,WAAWyB,EAAIE,SAE3B,GAAID,EAAQ,CACXE,SAAS,eAAgB,SAAUC,GAClCA,EAAMC,WAAWJ,SAEZ,CACN3B,IAAIgC,QAAQpB,EAAQJ,UAMxB,OAAO1B","file":"public/src/client/chats/search.js","sourcesContent":["'use strict';\n\n\ndefine('forum/chats/search', ['components', 'api'], function (components, api) {\n\tvar search = {};\n\n\tsearch.init = function () {\n\t\tvar timeoutId = 0;\n\n\t\tcomponents.get('chat/search').on('keyup', function () {\n\t\t\tif (timeoutId) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\n\t\t\ttimeoutId = setTimeout(doSearch, 250);\n\t\t});\n\t};\n\n\tfunction doSearch() {\n\t\tvar username = components.get('chat/search').val();\n\t\tif (!username) {\n\t\t\treturn $('[component=\"chat/search/list\"]').empty();\n\t\t}\n\n\t\tapi.get('/api/users', {\n\t\t\tquery: username,\n\t\t\tsearchBy: 'username',\n\t\t\tpaginate: false,\n\t\t}).then(displayResults)\n\t\t\t.catch(app.alertError);\n\t}\n\n\tfunction displayResults(data) {\n\t\tvar chatsListEl = $('[component=\"chat/search/list\"]');\n\t\tchatsListEl.empty();\n\n\t\tdata.users = data.users.filter(function (user) {\n\t\t\treturn parseInt(user.uid, 10) !== parseInt(app.user.uid, 10);\n\t\t});\n\n\t\tif (!data.users.length) {\n\t\t\treturn chatsListEl.translateHtml('<li><div><span>[[users:no-users-found]]</span></div></li>');\n\t\t}\n\n\t\tdata.users.forEach(function (userObj) {\n\t\t\tvar chatEl = displayUser(chatsListEl, userObj);\n\t\t\tonUserClick(chatEl, userObj);\n\t\t});\n\n\t\tchatsListEl.parent().toggleClass('open', true);\n\t}\n\n\tfunction displayUser(chatsListEl, userObj) {\n\t\tfunction createUserImage() {\n\t\t\treturn (userObj.picture ?\n\t\t\t\t'<img src=\"' +\tuserObj.picture + '\" title=\"' +\tuserObj.username + '\" />' :\n\t\t\t\t'<div class=\"user-icon\" style=\"background-color: ' + userObj['icon:bgColor'] + '\">' + userObj['icon:text'] + '</div>') +\n\t\t\t\t'<i class=\"fa fa-circle status ' + userObj.status + '\"></i> ' + userObj.username;\n\t\t}\n\n\t\tvar chatEl = $('<li component=\"chat/search/user\"></li>')\n\t\t\t.attr('data-uid', userObj.uid)\n\t\t\t.appendTo(chatsListEl);\n\n\t\tchatEl.append(createUserImage());\n\t\treturn chatEl;\n\t}\n\n\tfunction onUserClick(chatEl, userObj) {\n\t\tchatEl.on('click', function () {\n\t\t\tsocket.emit('modules.chats.hasPrivateChat', userObj.uid, function (err, roomId) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tif (roomId) {\n\t\t\t\t\trequire(['forum/chats'], function (chats) {\n\t\t\t\t\t\tchats.switchChat(roomId);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tapp.newChat(userObj.uid);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\treturn search;\n});\n"]}