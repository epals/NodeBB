{"version":3,"sources":["public/src/client/categories.js"],"names":["define","components","categorySelector","categories","$","window","on","ev","data","ajaxify","currentPage","url","socket","removeListener","onNewPost","init","app","enterRoom","privilege","onSelect","category","go","cid","tooltip","placement","posts","length","topic","renderNewPost","post","get","numRecentReplies","attr","parseInt","find","recentPosts","parseAndTranslate","html","addClass","hide","appendTo","insertBefore","first","fadeIn","createUserTooltips","timeago","last","remove","trigger"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,aAAc,oBAAqB,SAAUC,EAAYC,GACpF,IAAIC,KAEJC,EAAEC,QAAQC,GAAG,uBAAwB,SAAUC,EAAIC,GAClD,GAAIC,QAAQC,cAAgBF,EAAKG,IAAK,CACrCC,OAAOC,eAAe,iBAAkBV,EAAWW,cAIrDX,EAAWY,KAAO,WACjBC,IAAIC,UAAU,cAEdL,OAAOC,eAAe,iBAAkBV,EAAWW,WACnDF,OAAON,GAAG,iBAAkBH,EAAWW,WACvCZ,EAAiBa,KAAKX,EAAE,oCACvBc,UAAW,OACXC,SAAU,SAAUC,GACnBX,QAAQY,GAAG,aAAeD,EAASE,QAIrClB,EAAE,oBAAoBmB,SACrBC,UAAW,YAIbrB,EAAWW,UAAY,SAAUN,GAChC,GAAIA,GAAQA,EAAKiB,OAASjB,EAAKiB,MAAMC,QAAUlB,EAAKiB,MAAM,GAAGE,MAAO,CACnEC,EAAcpB,EAAKiB,MAAM,GAAGE,MAAML,IAAKd,EAAKiB,MAAM,MAIpD,SAASG,EAAcN,EAAKO,GAC3B,IAAIT,EAAWnB,EAAW6B,IAAI,sBAAuB,MAAOR,GAC5D,IAAIS,EAAmBX,EAASY,KAAK,yBACrC,IAAKD,IAAqBE,SAASF,EAAkB,IAAK,CACzD,OAED,IAAKX,EAASc,KAAK,8BAA8BR,OAAQ,CACxD,OAGD,IAAIS,EAAcf,EAASc,KAAK,gCAEhClB,IAAIoB,kBAAkB,+BAAgC,SAAWX,OAAQI,IAAS,SAAUQ,GAC3FA,EAAKH,KAAK,0CAA0CI,SAAS,kBAC7DD,EAAKE,OACL,GAAIJ,EAAYT,SAAW,EAAG,CAC7BW,EAAKG,SAASpB,OACR,CACNiB,EAAKI,aAAaN,EAAYO,SAG/BL,EAAKM,SAEL3B,IAAI4B,qBACJP,EAAKH,KAAK,YAAYW,UAEtB,GAAIzB,EAASc,KAAK,gCAAgCR,OAASO,SAASF,EAAkB,IAAK,CAC1FI,EAAYW,OAAOC,SAGpB3C,EAAEC,QAAQ2C,QAAQ,uBAAyBvB,OAAQI,OAIrD,OAAO1B","file":"public/src/client/categories.js","sourcesContent":["'use strict';\n\n\ndefine('forum/categories', ['components', 'categorySelector'], function (components, categorySelector) {\n\tvar\tcategories = {};\n\n\t$(window).on('action:ajaxify.start', function (ev, data) {\n\t\tif (ajaxify.currentPage !== data.url) {\n\t\t\tsocket.removeListener('event:new_post', categories.onNewPost);\n\t\t}\n\t});\n\n\tcategories.init = function () {\n\t\tapp.enterRoom('categories');\n\n\t\tsocket.removeListener('event:new_post', categories.onNewPost);\n\t\tsocket.on('event:new_post', categories.onNewPost);\n\t\tcategorySelector.init($('[component=\"category-selector\"]'), {\n\t\t\tprivilege: 'find',\n\t\t\tonSelect: function (category) {\n\t\t\t\tajaxify.go('/category/' + category.cid);\n\t\t\t},\n\t\t});\n\n\t\t$('.category-header').tooltip({\n\t\t\tplacement: 'bottom',\n\t\t});\n\t};\n\n\tcategories.onNewPost = function (data) {\n\t\tif (data && data.posts && data.posts.length && data.posts[0].topic) {\n\t\t\trenderNewPost(data.posts[0].topic.cid, data.posts[0]);\n\t\t}\n\t};\n\n\tfunction renderNewPost(cid, post) {\n\t\tvar category = components.get('categories/category', 'cid', cid);\n\t\tvar numRecentReplies = category.attr('data-numRecentReplies');\n\t\tif (!numRecentReplies || !parseInt(numRecentReplies, 10)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!category.find('[component=\"topic/teaser\"]').length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar recentPosts = category.find('[component=\"category/posts\"]');\n\n\t\tapp.parseAndTranslate('partials/categories/lastpost', 'posts', { posts: [post] }, function (html) {\n\t\t\thtml.find('.post-content img:not(.not-responsive)').addClass('img-responsive');\n\t\t\thtml.hide();\n\t\t\tif (recentPosts.length === 0) {\n\t\t\t\thtml.appendTo(category);\n\t\t\t} else {\n\t\t\t\thtml.insertBefore(recentPosts.first());\n\t\t\t}\n\n\t\t\thtml.fadeIn();\n\n\t\t\tapp.createUserTooltips();\n\t\t\thtml.find('.timeago').timeago();\n\n\t\t\tif (category.find('[component=\"category/posts\"]').length > parseInt(numRecentReplies, 10)) {\n\t\t\t\trecentPosts.last().remove();\n\t\t\t}\n\n\t\t\t$(window).trigger('action:posts.loaded', { posts: [post] });\n\t\t});\n\t}\n\n\treturn categories;\n});\n"]}