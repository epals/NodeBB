{"version":3,"sources":["public/src/client/account/edit.js"],"names":["define","header","picture","translator","api","hooks","AccountEdit","init","$","on","updateProfile","app","loadJQueryUI","datepicker","changeMonth","changeYear","yearRange","defaultDate","handleImageChange","handleAccountDelete","handleEmailConfirm","updateSignature","updateAboutMe","handleGroupSort","userData","serializeObject","uid","ajaxify","data","groupTitle","JSON","stringify","Array","isArray","fire","put","then","res","alertSuccess","attr","updateHeader","catch","alertError","openChangeModal","translate","translated","modal","bootbox","confirm","confirmBtn","find","html","prop","socket","emit","password","val","err","restoreButton","confirmText","text","message","logout","focus","btn","this","removeAttr","getCharsLeft","el","max","length","maximumSignatureLength","maximumAboutMeLength","move","direction","selected","allowMultipleBadges","insertAfter","next","prev","insertBefore"],"mappings":"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","file":"public/src/client/account/edit.js","sourcesContent":["'use strict';\n\ndefine('forum/account/edit', [\n\t'forum/account/header',\n\t'accounts/picture',\n\t'translator',\n\t'api',\n\t'hooks',\n], function (header, picture, translator, api, hooks) {\n\tvar AccountEdit = {};\n\n\tAccountEdit.init = function () {\n\t\theader.init();\n\n\t\t$('#submitBtn').on('click', updateProfile);\n\n\t\tapp.loadJQueryUI(function () {\n\t\t\t$('#inputBirthday').datepicker({\n\t\t\t\tchangeMonth: true,\n\t\t\t\tchangeYear: true,\n\t\t\t\tyearRange: '1900:-5y',\n\t\t\t\tdefaultDate: '-13y',\n\t\t\t});\n\t\t});\n\n\t\thandleImageChange();\n\t\thandleAccountDelete();\n\t\thandleEmailConfirm();\n\t\tupdateSignature();\n\t\tupdateAboutMe();\n\t\thandleGroupSort();\n\t};\n\n\tfunction updateProfile() {\n\t\tconst userData = $('form[component=\"profile/edit/form\"]').serializeObject();\n\t\tuserData.uid = ajaxify.data.uid;\n\t\tuserData.groupTitle = JSON.stringify(\n\t\t\tArray.isArray(userData.groupTitle) ? userData.groupTitle : [userData.groupTitle]\n\t\t);\n\n\t\thooks.fire('action:profile.update', userData);\n\n\t\tapi.put('/users/' + userData.uid, userData).then((res) => {\n\t\t\tapp.alertSuccess('[[user:profile_update_success]]');\n\n\t\t\tif (res.picture) {\n\t\t\t\t$('#user-current-picture').attr('src', res.picture);\n\t\t\t}\n\n\t\t\tpicture.updateHeader(res.picture);\n\t\t}).catch(app.alertError);\n\n\t\treturn false;\n\t}\n\n\tfunction handleImageChange() {\n\t\t$('#changePictureBtn').on('click', function () {\n\t\t\tpicture.openChangeModal();\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction handleAccountDelete() {\n\t\t$('#deleteAccountBtn').on('click', function () {\n\t\t\ttranslator.translate('[[user:delete_account_confirm]]', function (translated) {\n\t\t\t\tvar modal = bootbox.confirm(translated + '<p><input type=\"password\" class=\"form-control\" id=\"confirm-password\" /></p>', function (confirm) {\n\t\t\t\t\tif (!confirm) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar confirmBtn = modal.find('.btn-primary');\n\t\t\t\t\tconfirmBtn.html('<i class=\"fa fa-spinner fa-spin\"></i>');\n\t\t\t\t\tconfirmBtn.prop('disabled', true);\n\n\t\t\t\t\tsocket.emit('user.deleteAccount', {\n\t\t\t\t\t\tpassword: $('#confirm-password').val(),\n\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\tfunction restoreButton() {\n\t\t\t\t\t\t\ttranslator.translate('[[modules:bootbox.confirm]]', function (confirmText) {\n\t\t\t\t\t\t\t\tconfirmBtn.text(confirmText);\n\t\t\t\t\t\t\t\tconfirmBtn.prop('disabled', false);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\trestoreButton();\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconfirmBtn.html('<i class=\"fa fa-check\"></i>');\n\t\t\t\t\t\tapp.logout();\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\n\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\tmodal.find('input').focus();\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction handleEmailConfirm() {\n\t\t$('#confirm-email').on('click', function () {\n\t\t\tvar btn = $(this).attr('disabled', true);\n\t\t\tsocket.emit('user.emailConfirm', {}, function (err) {\n\t\t\t\tbtn.removeAttr('disabled');\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction getCharsLeft(el, max) {\n\t\treturn el.length ? '(' + el.val().length + '/' + max + ')' : '';\n\t}\n\n\tfunction updateSignature() {\n\t\tvar el = $('#signature');\n\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\n\n\t\tel.on('keyup change', function () {\n\t\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\n\t\t});\n\t}\n\n\tfunction updateAboutMe() {\n\t\tvar el = $('#aboutme');\n\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\n\n\t\tel.on('keyup change', function () {\n\t\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\n\t\t});\n\t}\n\n\tfunction handleGroupSort() {\n\t\tfunction move(direction) {\n\t\t\tvar selected = $('#groupTitle').val();\n\t\t\tif (!ajaxify.data.allowMultipleBadges || (Array.isArray(selected) && selected.length > 1)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar el = $('#groupTitle').find(':selected');\n\t\t\tif (el.length && el.val()) {\n\t\t\t\tif (direction > 0) {\n\t\t\t\t\tel.insertAfter(el.next());\n\t\t\t\t} else if (el.prev().val()) {\n\t\t\t\t\tel.insertBefore(el.prev());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$('[component=\"group/order/up\"]').on('click', function () {\n\t\t\tmove(-1);\n\t\t});\n\t\t$('[component=\"group/order/down\"]').on('click', function () {\n\t\t\tmove(1);\n\t\t});\n\t}\n\n\treturn AccountEdit;\n});\n"]}