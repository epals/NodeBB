{"version":3,"sources":["public/src/client/account/blocks.js"],"names":["define","header","api","Blocks","init","$","on","username","this","value","get","query","searchBy","paginate","err","data","app","alertError","message","matchCount","users","length","parseAndTranslate","edit","html","uid","parseInt","getAttribute","socket","emit","blockeeUid","blockerUid","ajaxify","refreshList","config","relative_path","currentPage","done","payload","siblings","window","trigger","fail","go"],"mappings":"AAAA,aAEAA,OAAO,wBACN,uBACA,OACE,SAAUC,EAAQC,GACpB,IAAIC,KAEJA,EAAOC,KAAO,WACbH,EAAOG,OAEPC,EAAE,gBAAgBC,GAAG,QAAS,WAC7B,IAAIC,EAAWC,KAAKC,MAEpBP,EAAIQ,IAAI,cACPC,MAAOJ,EACPK,SAAU,WACVC,SAAU,OACR,SAAUC,EAAKC,GACjB,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAI3B,GAAIH,EAAKI,WAAa,GAAI,CACzBJ,EAAKK,MAAMC,OAAS,GAGrBL,IAAIM,kBAAkB,iBAAkB,QACvCC,KAAMR,EAAKK,OACT,SAAUI,GACZnB,EAAE,eAAemB,KAAKA,SAKzBnB,EAAE,eAAeC,GAAG,QAAS,yBAA0B,WACtD,IAAImB,EAAMC,SAASlB,KAAKmB,aAAa,YAAa,IAClDC,OAAOC,KAAK,oBACXC,WAAYL,EACZM,WAAYC,QAAQjB,KAAKU,KACvBtB,EAAO8B,gBAIZ9B,EAAO8B,YAAc,SAAUnB,GAC9B,GAAIA,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3Bb,EAAEK,IAAIwB,OAAOC,cAAgB,QAAUH,QAAQI,aAC7CC,KAAK,SAAUC,GACftB,IAAIM,kBAAkB,iBAAkB,QAASgB,EAAS,SAAUd,GACnEnB,EAAE,oBAAoBmB,KAAKA,GAC3BnB,EAAE,oBAAoBkC,SAAS,aAAaf,EAAKH,OAAS,OAAS,YAEpEhB,EAAEmC,QAAQC,QAAQ,6BAA+B1B,KAAMuB,MAEvDI,KAAK,WACLV,QAAQW,GAAGX,QAAQI,gBAItB,OAAOjC","file":"public/src/client/account/blocks.js","sourcesContent":["'use strict';\n\ndefine('forum/account/blocks', [\n\t'forum/account/header',\n\t'api',\n], function (header, api) {\n\tvar Blocks = {};\n\n\tBlocks.init = function () {\n\t\theader.init();\n\n\t\t$('#user-search').on('keyup', function () {\n\t\t\tvar username = this.value;\n\n\t\t\tapi.get('/api/users', {\n\t\t\t\tquery: username,\n\t\t\t\tsearchBy: 'username',\n\t\t\t\tpaginate: false,\n\t\t\t}, function (err, data) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\t// Only show first 10 matches\n\t\t\t\tif (data.matchCount > 10) {\n\t\t\t\t\tdata.users.length = 10;\n\t\t\t\t}\n\n\t\t\t\tapp.parseAndTranslate('account/blocks', 'edit', {\n\t\t\t\t\tedit: data.users,\n\t\t\t\t}, function (html) {\n\t\t\t\t\t$('.block-edit').html(html);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.block-edit').on('click', '[data-action=\"toggle\"]', function () {\n\t\t\tvar uid = parseInt(this.getAttribute('data-uid'), 10);\n\t\t\tsocket.emit('user.toggleBlock', {\n\t\t\t\tblockeeUid: uid,\n\t\t\t\tblockerUid: ajaxify.data.uid,\n\t\t\t}, Blocks.refreshList);\n\t\t});\n\t};\n\n\tBlocks.refreshList = function (err) {\n\t\tif (err) {\n\t\t\treturn app.alertError(err.message);\n\t\t}\n\n\t\t$.get(config.relative_path + '/api/' + ajaxify.currentPage)\n\t\t\t.done(function (payload) {\n\t\t\t\tapp.parseAndTranslate('account/blocks', 'users', payload, function (html) {\n\t\t\t\t\t$('#users-container').html(html);\n\t\t\t\t\t$('#users-container').siblings('div.alert')[html.length ? 'hide' : 'show']();\n\t\t\t\t});\n\t\t\t\t$(window).trigger('action:user.blocks.toggle', { data: payload });\n\t\t\t})\n\t\t\t.fail(function () {\n\t\t\t\tajaxify.go(ajaxify.currentPage);\n\t\t\t});\n\t};\n\n\treturn Blocks;\n});\n"]}