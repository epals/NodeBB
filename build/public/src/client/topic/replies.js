"use strict";define("forum/topic/replies",["navigator","components","forum/topic/posts","hooks"],function(e,t,o,s){var i={};i.init=function(e){var t=e.closest("[data-pid]");var i=t.data("pid");var n=e.find('[component="post/replies/open"]');var a=e.find('[component="post/replies/loading"]');var d=e.find('[component="post/replies/close"]');if(n.is(":not(.hidden)")&&a.is(".hidden")){n.addClass("hidden");a.removeClass("hidden");socket.emit("posts.getReplies",i,function(i,p){a.addClass("hidden");if(i){n.removeClass("hidden");return app.alertError(i.message)}d.removeClass("hidden");o.modifyPostsByPrivileges(p);var r={posts:p,privileges:ajaxify.data.privileges,"downvote:disabled":ajaxify.data["downvote:disabled"],"reputation:disabled":ajaxify.data["reputation:disabled"],loggedIn:!!app.user.uid,hideReplies:config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:true};app.parseAndTranslate("topic","posts",r,function(i){var n=$("<div>",{component:"post/replies"}).html(i).hide();if(e.attr("data-target-component")){t.find('[component="'+e.attr("data-target-component")+'"]').html(n)}else{n.insertAfter(e)}n.slideDown("fast");o.onNewPostsAddedToDom(i);s.fire("action:posts.loaded",{posts:p})})})}else if(d.is(":not(.hidden)")){d.addClass("hidden");n.removeClass("hidden");a.addClass("hidden");t.find('[component="post/replies"]').slideUp("fast",function(){$(this).remove()})}};i.onNewPost=function(e){var t=e.posts[0];if(!t){return}n(t,1);e.hideReplies=config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:true;app.parseAndTranslate("topic","posts",e,function(e){var s=$('[component="post"][data-pid="'+t.toPid+'"] [component="post/replies"]').first();if(s.length){if(config.topicPostSort==="newest_to_oldest"){s.prepend(e)}else{s.append(e)}o.onNewPostsAddedToDom(e)}})};i.onPostPurged=function(e){n(e,-1)};function n(e,t){var o=$('[component="post"][data-pid="'+e.toPid+'"]').find('[component="post/reply-count"]').first();var s=o.find('[component="post/reply-count/text"]');var i=o.find('[component="post/reply-count/avatars"]');var n=Math.max(0,parseInt(s.attr("data-replies"),10)+t);var a=o.find(".timeago").attr("title",e.timestampISO);s.attr("data-replies",n);o.toggleClass("hidden",n<=0);if(n>1){s.translateText("[[topic:replies_to_this_post, "+n+"]]")}else{s.translateText("[[topic:one_reply_to_this_post]]")}if(!i.find('[data-uid="'+e.uid+'"]').length&&n<7){app.parseAndTranslate("topic","posts",{posts:[{replies:{users:[e.user]}}]},function(e){i.prepend(e.find('[component="post/reply-count/avatars"] [component="avatar/picture"]'))})}i.addClass("hasMore");a.data("timeago",null).timeago()}return i});
//# sourceMappingURL=replies.js.map