{"version":3,"sources":["public/src/client/topic/change-owner.js"],"names":["define","components","postSelect","autocomplete","ChangeOwner","modal","commit","toUid","init","postEl","app","parseAndTranslate","html","find","$","append","on","closeModal","checkButtonEnable","onPostToggled","allowMainPostSelect","showPostsSelected","togglePostSelection","attr","changeOwner","user","filters","ev","ui","item","uid","pids","length","translateHtml","val","removeAttr","socket","emit","err","alertError","message","ajaxify","refresh","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,4BACN,aACA,aACA,gBACE,SAAUC,EAAYC,EAAYC,GACpC,IAAIC,KAEJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAAQ,EACZH,EAAYI,KAAO,SAAUC,GAC5B,GAAIJ,EAAO,CACV,OAEDK,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClEP,EAAQO,EAERN,EAASD,EAAMQ,KAAK,wBAEpBC,EAAE,QAAQC,OAAOV,GAEjBA,EAAMQ,KAAK,+BAA+BG,GAAG,QAASC,GACtDZ,EAAMQ,KAAK,aAAaG,GAAG,QAASE,GACpChB,EAAWM,KAAKW,GACfC,oBAAqB,OAEtBC,IAEA,GAAIZ,EAAQ,CACXP,EAAWoB,oBAAoBb,EAAQA,EAAOc,KAAK,aAGpDjB,EAAOU,GAAG,QAAS,WAClBQ,MAGDrB,EAAasB,KAAKpB,EAAMQ,KAAK,cAAgBa,SAAU,cAAgB,SAAUC,EAAIC,GACpFrB,EAAQqB,EAAGC,KAAKJ,KAAKK,IACrBZ,SAKH,SAASG,IACR,GAAInB,EAAW6B,KAAKC,OAAQ,CAC3B3B,EAAMQ,KAAK,SAASoB,cAAc,2BAA6B/B,EAAW6B,KAAKC,OAAS,UAClF,CACN3B,EAAMQ,KAAK,SAASoB,cAAc,2BAIpC,SAASf,IACR,GAAIX,GAASF,EAAMQ,KAAK,aAAamB,QAAU3B,EAAMQ,KAAK,aAAaqB,MAAMF,QAAU9B,EAAW6B,KAAKC,OAAQ,CAC9G1B,EAAO6B,WAAW,gBACZ,CACN7B,EAAOiB,KAAK,WAAY,OAI1B,SAASJ,IACRD,IACAG,IAGD,SAASG,IACR,IAAKjB,EAAO,CACX,OAED6B,OAAOC,KAAK,qBAAuBN,KAAM7B,EAAW6B,KAAMxB,MAAOA,GAAS,SAAU+B,GACnF,GAAIA,EAAK,CACR,OAAO5B,IAAI6B,WAAWD,EAAIE,SAE3BC,QAAQC,UAERzB,MAIF,SAASA,IACR,GAAIZ,EAAO,CACVA,EAAMsC,SACNtC,EAAQ,KACRH,EAAW0C,WAIb,OAAOxC","file":"public/src/client/topic/change-owner.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/change-owner', [\n\t'components',\n\t'postSelect',\n\t'autocomplete',\n], function (components, postSelect, autocomplete) {\n\tvar ChangeOwner = {};\n\n\tvar modal;\n\tvar commit;\n\tvar toUid = 0;\n\tChangeOwner.init = function (postEl) {\n\t\tif (modal) {\n\t\t\treturn;\n\t\t}\n\t\tapp.parseAndTranslate('partials/change_owner_modal', {}, function (html) {\n\t\t\tmodal = html;\n\n\t\t\tcommit = modal.find('#change_owner_commit');\n\n\t\t\t$('body').append(modal);\n\n\t\t\tmodal.find('.close,#change_owner_cancel').on('click', closeModal);\n\t\t\tmodal.find('#username').on('keyup', checkButtonEnable);\n\t\t\tpostSelect.init(onPostToggled, {\n\t\t\t\tallowMainPostSelect: true,\n\t\t\t});\n\t\t\tshowPostsSelected();\n\n\t\t\tif (postEl) {\n\t\t\t\tpostSelect.togglePostSelection(postEl, postEl.attr('data-pid'));\n\t\t\t}\n\n\t\t\tcommit.on('click', function () {\n\t\t\t\tchangeOwner();\n\t\t\t});\n\n\t\t\tautocomplete.user(modal.find('#username'), { filters: ['notbanned'] }, function (ev, ui) {\n\t\t\t\ttoUid = ui.item.user.uid;\n\t\t\t\tcheckButtonEnable();\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction showPostsSelected() {\n\t\tif (postSelect.pids.length) {\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\n\t\t} else {\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\n\t\t}\n\t}\n\n\tfunction checkButtonEnable() {\n\t\tif (toUid && modal.find('#username').length && modal.find('#username').val().length && postSelect.pids.length) {\n\t\t\tcommit.removeAttr('disabled');\n\t\t} else {\n\t\t\tcommit.attr('disabled', true);\n\t\t}\n\t}\n\n\tfunction onPostToggled() {\n\t\tcheckButtonEnable();\n\t\tshowPostsSelected();\n\t}\n\n\tfunction changeOwner() {\n\t\tif (!toUid) {\n\t\t\treturn;\n\t\t}\n\t\tsocket.emit('posts.changeOwner', { pids: postSelect.pids, toUid: toUid }, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tajaxify.refresh();\n\n\t\t\tcloseModal();\n\t\t});\n\t}\n\n\tfunction closeModal() {\n\t\tif (modal) {\n\t\t\tmodal.remove();\n\t\t\tmodal = null;\n\t\t\tpostSelect.disable();\n\t\t}\n\t}\n\n\treturn ChangeOwner;\n});\n"]}