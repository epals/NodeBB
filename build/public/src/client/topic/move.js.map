{"version":3,"sources":["public/src/client/topic/move.js"],"names":["define","categorySelector","alerts","Move","modal","selectedCategory","init","tids","currentCid","onComplete","moveAll","showModal","app","parseAndTranslate","html","on","remove","find","addClass","length","translateText","onSelect","onCategorySelected","privilege","onCommitClicked","category","prop","commitEl","cid","message","name","data","slice","config","undoTimeout","alert","alert_id","join","title","type","timeout","timeoutfn","moveTopics","clickfn","params","alertSuccess","$","window","trigger","socket","emit","err","alertError"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,mBAAoB,UAAW,SAAUC,EAAkBC,GACtF,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJF,EAAKG,KAAO,SAAUC,EAAMC,EAAYC,GACvCN,EAAKI,KAAOA,EACZJ,EAAKK,WAAaA,EAClBL,EAAKM,WAAaA,EAClBN,EAAKO,SAAWH,EAEhBI,KAGD,SAASA,IACRC,IAAIC,kBAAkB,gCAAkC,SAAUC,GACjEV,EAAQU,EACRV,EAAMW,GAAG,kBAAmB,WAC3BX,EAAMY,WAGPZ,EAAMa,KAAK,iBAAiBC,SAAS,QAErC,GAAIf,EAAKO,SAAYP,EAAKI,MAAQJ,EAAKI,KAAKY,OAAS,EAAI,CACxDf,EAAMa,KAAK,oBAAoBG,cAAc,yBAG9CnB,EAAiBK,KAAKF,EAAMa,KAAK,oCAChCI,SAAUC,EACVC,UAAW,aAGZnB,EAAMa,KAAK,uBAAuBF,GAAG,QAASS,GAE9CpB,EAAMA,MAAM,UAId,SAASkB,EAAmBG,GAC3BpB,EAAmBoB,EACnBrB,EAAMa,KAAK,uBAAuBS,KAAK,WAAY,OAGpD,SAASF,IACR,IAAIG,EAAWvB,EAAMa,KAAK,uBAE1B,IAAKU,EAASD,KAAK,aAAerB,GAAoBA,EAAiBuB,IAAK,CAC3ED,EAASD,KAAK,WAAY,MAE1BtB,EAAMA,MAAM,QACZ,IAAIyB,EAAU,+BAAiCxB,EAAiByB,KAAO,KACvE,GAAI3B,EAAKI,MAAQJ,EAAKI,KAAKY,OAAS,EAAG,CACtCU,EAAU,wCAA0CxB,EAAiByB,KAAO,UACtE,IAAK3B,EAAKI,KAAM,CACtBsB,EAAU,mCAAqCxB,EAAiByB,KAAO,KAExE,IAAIC,GACHxB,KAAMJ,EAAKI,KAAOJ,EAAKI,KAAKyB,QAAU,KACtCJ,IAAKvB,EAAiBuB,IACtBpB,WAAYL,EAAKK,WACjBC,WAAYN,EAAKM,YAElB,GAAIwB,OAAOC,YAAc,EAAG,CAC3B,OAAOhC,EAAOiC,OACbC,SAAU,cAAgBjC,EAAKI,KAAOJ,EAAKI,KAAK8B,KAAK,KAAO,OAC5DC,MAAO,8BACPT,QAASA,EACTU,KAAM,UACNC,QAASP,OAAOC,YAChBO,UAAW,WACVC,EAAWX,IAEZY,QAAS,SAAUR,EAAOS,UAClBA,EAAOH,UACd7B,IAAIiC,aAAa,kCAKpBH,EAAWX,IAIb,SAASW,EAAWX,GACnBe,EAAEC,QAAQC,QAAQ,oBAAqBjB,GAEvCkB,OAAOC,MAAMnB,EAAKxB,KAAO,iBAAmB,cAAewB,EAAM,SAAUoB,GAC1E,GAAIA,EAAK,CACR,OAAOvC,IAAIwC,WAAWD,EAAItB,SAG3B,UAAWE,EAAKtB,aAAe,WAAY,CAC1CsB,EAAKtB,gBAKR,OAAON","file":"public/src/client/topic/move.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/move', ['categorySelector', 'alerts'], function (categorySelector, alerts) {\n\tvar Move = {};\n\tvar modal;\n\tvar selectedCategory;\n\n\tMove.init = function (tids, currentCid, onComplete) {\n\t\tMove.tids = tids;\n\t\tMove.currentCid = currentCid;\n\t\tMove.onComplete = onComplete;\n\t\tMove.moveAll = !tids;\n\n\t\tshowModal();\n\t};\n\n\tfunction showModal() {\n\t\tapp.parseAndTranslate('partials/move_thread_modal', {}, function (html) {\n\t\t\tmodal = html;\n\t\t\tmodal.on('hidden.bs.modal', function () {\n\t\t\t\tmodal.remove();\n\t\t\t});\n\n\t\t\tmodal.find('#move-confirm').addClass('hide');\n\n\t\t\tif (Move.moveAll || (Move.tids && Move.tids.length > 1)) {\n\t\t\t\tmodal.find('.modal-header h3').translateText('[[topic:move_topics]]');\n\t\t\t}\n\n\t\t\tcategorySelector.init(modal.find('[component=\"category-selector\"]'), {\n\t\t\t\tonSelect: onCategorySelected,\n\t\t\t\tprivilege: 'moderate',\n\t\t\t});\n\n\t\t\tmodal.find('#move_thread_commit').on('click', onCommitClicked);\n\n\t\t\tmodal.modal('show');\n\t\t});\n\t}\n\n\tfunction onCategorySelected(category) {\n\t\tselectedCategory = category;\n\t\tmodal.find('#move_thread_commit').prop('disabled', false);\n\t}\n\n\tfunction onCommitClicked() {\n\t\tvar commitEl = modal.find('#move_thread_commit');\n\n\t\tif (!commitEl.prop('disabled') && selectedCategory && selectedCategory.cid) {\n\t\t\tcommitEl.prop('disabled', true);\n\n\t\t\tmodal.modal('hide');\n\t\t\tvar message = '[[topic:topic_move_success, ' + selectedCategory.name + ']]';\n\t\t\tif (Move.tids && Move.tids.length > 1) {\n\t\t\t\tmessage = '[[topic:topic_move_multiple_success, ' + selectedCategory.name + ']]';\n\t\t\t} else if (!Move.tids) {\n\t\t\t\tmessage = '[[topic:topic_move_all_success, ' + selectedCategory.name + ']]';\n\t\t\t}\n\t\t\tvar data = {\n\t\t\t\ttids: Move.tids ? Move.tids.slice() : null,\n\t\t\t\tcid: selectedCategory.cid,\n\t\t\t\tcurrentCid: Move.currentCid,\n\t\t\t\tonComplete: Move.onComplete,\n\t\t\t};\n\t\t\tif (config.undoTimeout > 0) {\n\t\t\t\treturn alerts.alert({\n\t\t\t\t\talert_id: 'tids_move_' + (Move.tids ? Move.tids.join('-') : 'all'),\n\t\t\t\t\ttitle: '[[topic:thread_tools.move]]',\n\t\t\t\t\tmessage: message,\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimeout: config.undoTimeout,\n\t\t\t\t\ttimeoutfn: function () {\n\t\t\t\t\t\tmoveTopics(data);\n\t\t\t\t\t},\n\t\t\t\t\tclickfn: function (alert, params) {\n\t\t\t\t\t\tdelete params.timeoutfn;\n\t\t\t\t\t\tapp.alertSuccess('[[topic:topic_move_undone]]');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmoveTopics(data);\n\t\t}\n\t}\n\n\tfunction moveTopics(data) {\n\t\t$(window).trigger('action:topic.move', data);\n\n\t\tsocket.emit(!data.tids ? 'topics.moveAll' : 'topics.move', data, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tif (typeof data.onComplete === 'function') {\n\t\t\t\tdata.onComplete();\n\t\t\t}\n\t\t});\n\t}\n\n\treturn Move;\n});\n"]}