{"version":3,"sources":["public/src/client/ip-blacklist.js"],"names":["define","Chart","Benchpress","Blacklist","init","blacklist","$","on","val","socket","emit","err","app","alertError","message","alert","type","alert_id","title","rules","data","render","then","html","bootbox","setupAnalytics","hourlyCanvas","document","getElementById","dailyCanvas","hourlyLabels","utils","getHoursArray","map","text","idx","dailyLabels","getDaysArray","slice","isMobile","defaults","global","tooltips","enabled","blacklist:hourly","labels","datasets","label","backgroundColor","borderColor","pointBackgroundColor","pointHoverBackgroundColor","pointBorderColor","pointHoverBorderColor","ajaxify","analytics","hourly","blacklist:daily","daily","width","parent","getContext","options","responsive","animation","legend","display","scales","yAxes","ticks","beginAtZero"],"mappings":"AAAA,aAGAA,OAAO,sBAAuB,QAAS,cAAe,SAAUC,EAAOC,GACtE,IAAIC,KAEJA,EAAUC,KAAO,WAChB,IAAIC,EAAYC,EAAE,oBAElBD,EAAUE,GAAG,QAAS,WACrBD,EAAE,2BAA2BE,IAAIH,EAAUG,SAG5CF,EAAE,yBAAyBC,GAAG,QAAS,WACtCE,OAAOC,KAAK,iBAAkBL,EAAUG,MAAO,SAAUG,GACxD,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BF,IAAIG,OACHC,KAAM,UACNC,SAAU,kBACVC,MAAO,gDAKVZ,EAAE,wBAAwBC,GAAG,QAAS,WACrCE,OAAOC,KAAK,sBACXS,MAAOd,EAAUG,OACf,SAAUG,EAAKS,GACjB,GAAIT,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3BZ,EAAWmB,OAAO,oCAAqCD,GAAME,KAAK,SAAUC,GAC3EC,QAAQT,MAAMQ,SAKjBpB,EAAUsB,kBAGXtB,EAAUsB,eAAiB,WAC1B,IAAIC,EAAeC,SAASC,eAAe,oBAC3C,IAAIC,EAAcF,SAASC,eAAe,mBAC1C,IAAIE,EAAeC,MAAMC,gBAAgBC,IAAI,SAAUC,EAAMC,GAC5D,OAAOA,EAAM,EAAI,GAAKD,IAEvB,IAAIE,EAAcL,MAAMM,eAAeC,OAAO,GAAGL,IAAI,SAAUC,EAAMC,GACpE,OAAOA,EAAM,EAAI,GAAKD,IAGvB,GAAIH,MAAMQ,WAAY,CACrBtC,EAAMuC,SAASC,OAAOC,SAASC,QAAU,MAG1C,IAAIvB,GACHwB,oBACCC,OAAQf,EACRgB,WAEEC,MAAO,GACPC,gBAAiB,wBACjBC,YAAa,sBACbC,qBAAsB,sBACtBC,0BAA2B,OAC3BC,iBAAkB,OAClBC,sBAAuB,sBACvBjC,KAAMkC,QAAQlC,KAAKmC,UAAUC,UAIhCC,mBACCZ,OAAQT,EACRU,WAEEC,MAAO,GACPC,gBAAiB,wBACjBC,YAAa,sBACbC,qBAAsB,sBACtBC,0BAA2B,OAC3BC,iBAAkB,OAClBC,sBAAuB,sBACvBjC,KAAMkC,QAAQlC,KAAKmC,UAAUG,UAMjChC,EAAaiC,MAAQrD,EAAEoB,GAAckC,SAASD,QAC9C9B,EAAY8B,MAAQrD,EAAEuB,GAAa+B,SAASD,QAE5C,IAAI1D,EAAMyB,EAAamC,WAAW,OACjC7C,KAAM,OACNI,KAAMA,EAAK,oBACX0C,SACCC,WAAY,KACZC,UAAW,MACXC,QACCC,QAAS,OAEVC,QACCC,QACCC,OACCC,YAAa,YAOlB,IAAIrE,EAAM4B,EAAYgC,WAAW,OAChC7C,KAAM,OACNI,KAAMA,EAAK,mBACX0C,SACCC,WAAY,KACZC,UAAW,MACXC,QACCC,QAAS,OAEVC,QACCC,QACCC,OACCC,YAAa,aAQnB,OAAOnE","file":"public/src/client/ip-blacklist.js","sourcesContent":["'use strict';\n\n\ndefine('forum/ip-blacklist', ['Chart', 'benchpress'], function (Chart, Benchpress) {\n\tvar Blacklist = {};\n\n\tBlacklist.init = function () {\n\t\tvar blacklist = $('#blacklist-rules');\n\n\t\tblacklist.on('keyup', function () {\n\t\t\t$('#blacklist-rules-holder').val(blacklist.val());\n\t\t});\n\n\t\t$('[data-action=\"apply\"]').on('click', function () {\n\t\t\tsocket.emit('blacklist.save', blacklist.val(), function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alert({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\talert_id: 'blacklist-saved',\n\t\t\t\t\ttitle: '[[ip-blacklist:alerts.applied-success]]',\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('[data-action=\"test\"]').on('click', function () {\n\t\t\tsocket.emit('blacklist.validate', {\n\t\t\t\trules: blacklist.val(),\n\t\t\t}, function (err, data) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\tBenchpress.render('admin/partials/blacklist-validate', data).then(function (html) {\n\t\t\t\t\tbootbox.alert(html);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tBlacklist.setupAnalytics();\n\t};\n\n\tBlacklist.setupAnalytics = function () {\n\t\tvar hourlyCanvas = document.getElementById('blacklist:hourly');\n\t\tvar\tdailyCanvas = document.getElementById('blacklist:daily');\n\t\tvar\thourlyLabels = utils.getHoursArray().map(function (text, idx) {\n\t\t\treturn idx % 3 ? '' : text;\n\t\t});\n\t\tvar\tdailyLabels = utils.getDaysArray().slice(-7).map(function (text, idx) {\n\t\t\treturn idx % 3 ? '' : text;\n\t\t});\n\n\t\tif (utils.isMobile()) {\n\t\t\tChart.defaults.global.tooltips.enabled = false;\n\t\t}\n\n\t\tvar data = {\n\t\t\t'blacklist:hourly': {\n\t\t\t\tlabels: hourlyLabels,\n\t\t\t\tdatasets: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\tbackgroundColor: 'rgba(186,139,175,0.2)',\n\t\t\t\t\t\tborderColor: 'rgba(186,139,175,1)',\n\t\t\t\t\t\tpointBackgroundColor: 'rgba(186,139,175,1)',\n\t\t\t\t\t\tpointHoverBackgroundColor: '#fff',\n\t\t\t\t\t\tpointBorderColor: '#fff',\n\t\t\t\t\t\tpointHoverBorderColor: 'rgba(186,139,175,1)',\n\t\t\t\t\t\tdata: ajaxify.data.analytics.hourly,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t'blacklist:daily': {\n\t\t\t\tlabels: dailyLabels,\n\t\t\t\tdatasets: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\tbackgroundColor: 'rgba(151,187,205,0.2)',\n\t\t\t\t\t\tborderColor: 'rgba(151,187,205,1)',\n\t\t\t\t\t\tpointBackgroundColor: 'rgba(151,187,205,1)',\n\t\t\t\t\t\tpointHoverBackgroundColor: '#fff',\n\t\t\t\t\t\tpointBorderColor: '#fff',\n\t\t\t\t\t\tpointHoverBorderColor: 'rgba(151,187,205,1)',\n\t\t\t\t\t\tdata: ajaxify.data.analytics.daily,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\n\t\thourlyCanvas.width = $(hourlyCanvas).parent().width();\n\t\tdailyCanvas.width = $(dailyCanvas).parent().width();\n\n\t\tnew Chart(hourlyCanvas.getContext('2d'), {\n\t\t\ttype: 'line',\n\t\t\tdata: data['blacklist:hourly'],\n\t\t\toptions: {\n\t\t\t\tresponsive: true,\n\t\t\t\tanimation: false,\n\t\t\t\tlegend: {\n\t\t\t\t\tdisplay: false,\n\t\t\t\t},\n\t\t\t\tscales: {\n\t\t\t\t\tyAxes: [{\n\t\t\t\t\t\tticks: {\n\t\t\t\t\t\t\tbeginAtZero: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t}],\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tnew Chart(dailyCanvas.getContext('2d'), {\n\t\t\ttype: 'line',\n\t\t\tdata: data['blacklist:daily'],\n\t\t\toptions: {\n\t\t\t\tresponsive: true,\n\t\t\t\tanimation: false,\n\t\t\t\tlegend: {\n\t\t\t\t\tdisplay: false,\n\t\t\t\t},\n\t\t\t\tscales: {\n\t\t\t\t\tyAxes: [{\n\t\t\t\t\t\tticks: {\n\t\t\t\t\t\t\tbeginAtZero: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t}],\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t};\n\n\treturn Blacklist;\n});\n"]}