{"version":3,"sources":["public/src/modules/categorySearch.js"],"names":["define","categorySearch","init","el","options","categoriesList","privilege","states","localCategories","Array","isArray","map","c","selectedCids","ajaxify","data","searchEl","find","length","toggleVisibility","parent","on","addClass","removeClass","doSearch","val","loadList","categories","renderList","forEach","selected","includes","cid","ev","preventDefault","stopPropagation","utils","debounce","focus","off","query","callback","socket","emit","parentCid","showLinks","err","app","alertError","concat","parseAndTranslate","template","categoryItems","slice","selectedCategory","allCategoriesUrl","html","replaceWith","toggleClass"],"mappings":"AAAA,aAEAA,OAAO,iBAAkB,WACxB,IAAIC,KAEJA,EAAeC,KAAO,SAAUC,EAAIC,GACnC,IAAIC,EAAiB,KACrBD,EAAUA,MACVA,EAAQE,UAAYF,EAAQE,WAAa,cACzCF,EAAQG,OAASH,EAAQG,SAAW,WAAY,cAAe,YAE/D,IAAIC,KACJ,GAAIC,MAAMC,QAAQN,EAAQI,iBAAkB,CAC3CA,EAAkBJ,EAAQI,gBAAgBG,IAAIC,QAAWA,KAE1DR,EAAQS,aAAeT,EAAQS,cAAgBC,QAAQC,KAAKF,iBAE5D,IAAIG,EAAWb,EAAGc,KAAK,0CACvB,IAAKD,EAASE,OAAQ,CACrB,OAGD,IAAIC,EAAmBH,EAASI,OAAO,mCAAmCF,OAAS,GAClFF,EAASI,OAAO,mCAAmCF,OAAS,EAE7Df,EAAGkB,GAAG,mBAAoB,WACzB,GAAIF,EAAkB,CACrBhB,EAAGc,KAAK,oBAAoBK,SAAS,UACrCN,EAASO,YAAY,UAGtB,SAASC,IACR,IAAIC,EAAMT,EAASC,KAAK,SAASQ,MACjC,GAAIA,EAAIP,OAAS,IAAOO,IAAQpB,EAAiB,CAChDqB,EAASD,EAAK,SAAUE,GACvBtB,EAAiBA,GAAkBsB,EACnCC,EAAWD,UAEN,IAAKF,GAAOpB,EAAgB,CAClCA,EAAewB,QAAQ,SAAUjB,GAChCA,EAAEkB,SAAW1B,EAAQS,aAAakB,SAASnB,EAAEoB,OAE9CJ,EAAWvB,IAIbW,EAASK,GAAG,QAAS,SAAUY,GAC9BA,EAAGC,iBACHD,EAAGE,oBAEJnB,EAASC,KAAK,SAASQ,IAAI,IAAIJ,GAAG,QAASe,MAAMC,SAASb,EAAU,MACpEA,MAGDrB,EAAGkB,GAAG,oBAAqB,WAC1BL,EAASC,KAAK,SAASqB,UAGxBnC,EAAGkB,GAAG,mBAAoB,WACzB,GAAIF,EAAkB,CACrBhB,EAAGc,KAAK,oBAAoBM,YAAY,UACxCP,EAASM,SAAS,UAGnBN,EAASuB,IAAI,SACbvB,EAASC,KAAK,SAASsB,IAAI,WAG5B,SAASb,EAASc,EAAOC,GACxBC,OAAOC,KAAK,6BACXH,MAAOA,EACPI,UAAWxC,EAAQwC,WAAa,EAChC/B,aAAcT,EAAQS,aACtBP,UAAWF,EAAQE,UACnBC,OAAQH,EAAQG,OAChBsC,UAAWzC,EAAQyC,WACjB,SAAUC,EAAKnB,GACjB,GAAImB,EAAK,CACR,OAAOC,IAAIC,WAAWF,GAEvBL,EAASjC,EAAgByC,OAAOtB,MAIlC,SAASC,EAAWD,GACnBoB,IAAIG,kBAAkB9C,EAAQ+C,UAC7BC,cAAezB,EAAW0B,MAAM,EAAG,KACnCC,iBAAkBxC,QAAQC,KAAKuC,iBAC/BC,iBAAkBzC,QAAQC,KAAKwC,kBAC7B,SAAUC,GACZrD,EAAGc,KAAK,+BACNwC,YAAYD,EAAKvC,KAAK,gCACxBd,EAAGc,KAAK,iEACNyC,YAAY,WAAY/B,EAAWT,YAKxC,OAAOjB","file":"public/src/modules/categorySearch.js","sourcesContent":["'use strict';\n\ndefine('categorySearch', function () {\n\tvar categorySearch = {};\n\n\tcategorySearch.init = function (el, options) {\n\t\tvar categoriesList = null;\n\t\toptions = options || {};\n\t\toptions.privilege = options.privilege || 'topics:read';\n\t\toptions.states = options.states || ['watching', 'notwatching', 'ignoring'];\n\n\t\tvar localCategories = [];\n\t\tif (Array.isArray(options.localCategories)) {\n\t\t\tlocalCategories = options.localCategories.map(c => ({ ...c }));\n\t\t}\n\t\toptions.selectedCids = options.selectedCids || ajaxify.data.selectedCids || [];\n\n\t\tvar searchEl = el.find('[component=\"category-selector-search\"]');\n\t\tif (!searchEl.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar toggleVisibility = searchEl.parent('[component=\"category/dropdown\"]').length > 0 ||\n\t\t\tsearchEl.parent('[component=\"category-selector\"]').length > 0;\n\n\t\tel.on('show.bs.dropdown', function () {\n\t\t\tif (toggleVisibility) {\n\t\t\t\tel.find('.dropdown-toggle').addClass('hidden');\n\t\t\t\tsearchEl.removeClass('hidden');\n\t\t\t}\n\n\t\t\tfunction doSearch() {\n\t\t\t\tvar val = searchEl.find('input').val();\n\t\t\t\tif (val.length > 1 || (!val && !categoriesList)) {\n\t\t\t\t\tloadList(val, function (categories) {\n\t\t\t\t\t\tcategoriesList = categoriesList || categories;\n\t\t\t\t\t\trenderList(categories);\n\t\t\t\t\t});\n\t\t\t\t} else if (!val && categoriesList) {\n\t\t\t\t\tcategoriesList.forEach(function (c) {\n\t\t\t\t\t\tc.selected = options.selectedCids.includes(c.cid);\n\t\t\t\t\t});\n\t\t\t\t\trenderList(categoriesList);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsearchEl.on('click', function (ev) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t});\n\t\t\tsearchEl.find('input').val('').on('keyup', utils.debounce(doSearch, 300));\n\t\t\tdoSearch();\n\t\t});\n\n\t\tel.on('shown.bs.dropdown', function () {\n\t\t\tsearchEl.find('input').focus();\n\t\t});\n\n\t\tel.on('hide.bs.dropdown', function () {\n\t\t\tif (toggleVisibility) {\n\t\t\t\tel.find('.dropdown-toggle').removeClass('hidden');\n\t\t\t\tsearchEl.addClass('hidden');\n\t\t\t}\n\n\t\t\tsearchEl.off('click');\n\t\t\tsearchEl.find('input').off('keyup');\n\t\t});\n\n\t\tfunction loadList(query, callback) {\n\t\t\tsocket.emit('categories.categorySearch', {\n\t\t\t\tquery: query,\n\t\t\t\tparentCid: options.parentCid || 0,\n\t\t\t\tselectedCids: options.selectedCids,\n\t\t\t\tprivilege: options.privilege,\n\t\t\t\tstates: options.states,\n\t\t\t\tshowLinks: options.showLinks,\n\t\t\t}, function (err, categories) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\t\t\t\tcallback(localCategories.concat(categories));\n\t\t\t});\n\t\t}\n\n\t\tfunction renderList(categories) {\n\t\t\tapp.parseAndTranslate(options.template, {\n\t\t\t\tcategoryItems: categories.slice(0, 200),\n\t\t\t\tselectedCategory: ajaxify.data.selectedCategory,\n\t\t\t\tallCategoriesUrl: ajaxify.data.allCategoriesUrl,\n\t\t\t}, function (html) {\n\t\t\t\tel.find('[component=\"category/list\"]')\n\t\t\t\t\t.replaceWith(html.find('[component=\"category/list\"]'));\n\t\t\t\tel.find('[component=\"category/list\"] [component=\"category/no-matches\"]')\n\t\t\t\t\t.toggleClass('hidden', !!categories.length);\n\t\t\t});\n\t\t}\n\t};\n\n\treturn categorySearch;\n});\n"]}