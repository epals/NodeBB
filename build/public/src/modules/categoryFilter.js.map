{"version":3,"sources":["public/src/modules/categoryFilter.js"],"names":["define","categorySearch","api","categoryFilter","init","el","options","length","states","template","$","window","trigger","selectedCids","initialCids","Array","isArray","map","cid","parseInt","ajaxify","data","slice","on","changed","forEach","index","updateFilterButton","onHidden","url","location","pathname","currentParams","utils","params","decodeURIComponent","param","go","listEl","find","categoryEl","this","link","attr","icon","includes","splice","indexOf","push","sort","a","b","toggleClass","onSelect","renderButton","name","bgColor","get","then","category","app","parseAndTranslate","selectedCategory","html","replaceWith"],"mappings":"AAAA,aAEAA,OAAO,kBAAmB,iBAAkB,OAAQ,SAAUC,EAAgBC,GAC7E,IAAIC,KAEJA,EAAeC,KAAO,SAAUC,EAAIC,GACnC,IAAKD,IAAOA,EAAGE,OAAQ,CACtB,OAEDD,EAAUA,MACVA,EAAQE,OAASF,EAAQE,SAAW,WAAY,cAAe,YAC/DF,EAAQG,SAAW,2BACnBC,EAAEC,QAAQC,QAAQ,kCAAoCP,GAAIA,EAAIC,QAASA,IAEvEL,EAAeG,KAAKC,EAAIC,GAExB,IAAIO,KACJ,IAAIC,KACJ,GAAIC,MAAMC,QAAQV,EAAQO,cAAe,CACxCA,EAAeP,EAAQO,aAAaI,IAAIC,GAAOC,SAASD,EAAK,UACvD,GAAIH,MAAMC,QAAQI,QAAQC,KAAKR,cAAe,CACpDA,EAAeO,QAAQC,KAAKR,aAAaI,IAAIC,GAAOC,SAASD,EAAK,KAEnEJ,EAAcD,EAAaS,QAE3BjB,EAAGkB,GAAG,qBAAsB,WAC3B,IAAIC,EAAUV,EAAYP,SAAWM,EAAaN,OAClDO,EAAYW,QAAQ,SAAUP,EAAKQ,GAClC,GAAIR,IAAQL,EAAaa,GAAQ,CAChCF,EAAU,QAGZ,GAAIA,EAAS,CACZG,EAAmBtB,EAAIQ,GAExB,GAAIP,EAAQsB,SAAU,CACrBtB,EAAQsB,UAAWJ,QAASA,EAASX,aAAcA,EAAaS,UAChE,OAED,GAAIE,EAAS,CACZ,IAAIK,EAAMlB,OAAOmB,SAASC,SAC1B,IAAIC,EAAgBC,MAAMC,SAC1B,GAAIrB,EAAaN,OAAQ,CACxByB,EAAcd,IAAML,EACpBgB,GAAO,IAAMM,mBAAmBzB,EAAE0B,MAAMJ,IAEzCZ,QAAQiB,GAAGR,MAIbxB,EAAGkB,GAAG,QAAS,yCAA0C,WACxD,IAAIe,EAASjC,EAAGkC,KAAK,+BACrB,IAAIC,EAAa9B,EAAE+B,MACnB,IAAIC,EAAOF,EAAWD,KAAK,KAAKI,KAAK,QACrC,GAAID,GAAQA,IAAS,KAAOA,EAAKnC,OAAQ,CACxC,OAED,IAAIW,EAAMC,SAASqB,EAAWG,KAAK,YAAa,IAChD,IAAIC,EAAOJ,EAAWD,KAAK,sCAE3B,GAAI1B,EAAagC,SAAS3B,GAAM,CAC/BL,EAAaiC,OAAOjC,EAAakC,QAAQ7B,GAAM,OACzC,CACNL,EAAamC,KAAK9B,GAEnBL,EAAaoC,KAAK,SAAUC,EAAGC,GAC9B,OAAOD,EAAIC,IAEZ7C,EAAQO,aAAeA,EAEvB+B,EAAKQ,YAAY,aACjBd,EAAOC,KAAK,wBAAwBa,YAAY,cAAevC,EAAaN,QAC5E,GAAID,EAAQ+C,SAAU,CACrB/C,EAAQ+C,UAAWnC,IAAKA,EAAKL,aAAcA,EAAaS,UAEzD,OAAO,SAIT,SAASK,EAAmBtB,EAAIQ,GAC/B,GAAIA,EAAaN,OAAS,EAAG,CAC5B+C,GACCV,KAAM,UACNW,KAAM,0CACNC,QAAS,cAEJ,GAAI3C,EAAaN,SAAW,EAAG,CACrCL,EAAIuD,mBAAmB5C,EAAa,SAAU6C,KAAKJ,OAC7C,CACNA,IAED,SAASA,EAAaK,GACrBC,IAAIC,kBAAkB,oCACrBC,iBAAkBH,GAChB,SAAUI,GACZ1D,EAAGkC,KAAK,UAAUyB,YAAYtD,EAAE,UAAUqD,KAAKA,GAAMxB,KAAK,cAK7D,OAAOpC","file":"public/src/modules/categoryFilter.js","sourcesContent":["'use strict';\n\ndefine('categoryFilter', ['categorySearch', 'api'], function (categorySearch, api) {\n\tvar categoryFilter = {};\n\n\tcategoryFilter.init = function (el, options) {\n\t\tif (!el || !el.length) {\n\t\t\treturn;\n\t\t}\n\t\toptions = options || {};\n\t\toptions.states = options.states || ['watching', 'notwatching', 'ignoring'];\n\t\toptions.template = 'partials/category-filter';\n\t\t$(window).trigger('action:category.filter.options', { el: el, options: options });\n\n\t\tcategorySearch.init(el, options);\n\n\t\tvar selectedCids = [];\n\t\tvar initialCids = [];\n\t\tif (Array.isArray(options.selectedCids)) {\n\t\t\tselectedCids = options.selectedCids.map(cid => parseInt(cid, 10));\n\t\t} else if (Array.isArray(ajaxify.data.selectedCids)) {\n\t\t\tselectedCids = ajaxify.data.selectedCids.map(cid => parseInt(cid, 10));\n\t\t}\n\t\tinitialCids = selectedCids.slice();\n\n\t\tel.on('hidden.bs.dropdown', function () {\n\t\t\tvar changed = initialCids.length !== selectedCids.length;\n\t\t\tinitialCids.forEach(function (cid, index) {\n\t\t\t\tif (cid !== selectedCids[index]) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (changed) {\n\t\t\t\tupdateFilterButton(el, selectedCids);\n\t\t\t}\n\t\t\tif (options.onHidden) {\n\t\t\t\toptions.onHidden({ changed: changed, selectedCids: selectedCids.slice() });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (changed) {\n\t\t\t\tvar url = window.location.pathname;\n\t\t\t\tvar currentParams = utils.params();\n\t\t\t\tif (selectedCids.length) {\n\t\t\t\t\tcurrentParams.cid = selectedCids;\n\t\t\t\t\turl += '?' + decodeURIComponent($.param(currentParams));\n\t\t\t\t}\n\t\t\t\tajaxify.go(url);\n\t\t\t}\n\t\t});\n\n\t\tel.on('click', '[component=\"category/list\"] [data-cid]', function () {\n\t\t\tvar listEl = el.find('[component=\"category/list\"]');\n\t\t\tvar categoryEl = $(this);\n\t\t\tvar link = categoryEl.find('a').attr('href');\n\t\t\tif (link && link !== '#' && link.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar cid = parseInt(categoryEl.attr('data-cid'), 10);\n\t\t\tvar icon = categoryEl.find('[component=\"category/select/icon\"]');\n\n\t\t\tif (selectedCids.includes(cid)) {\n\t\t\t\tselectedCids.splice(selectedCids.indexOf(cid), 1);\n\t\t\t} else {\n\t\t\t\tselectedCids.push(cid);\n\t\t\t}\n\t\t\tselectedCids.sort(function (a, b) {\n\t\t\t\treturn a - b;\n\t\t\t});\n\t\t\toptions.selectedCids = selectedCids;\n\n\t\t\ticon.toggleClass('invisible');\n\t\t\tlistEl.find('li[data-all=\"all\"] i').toggleClass('invisible', !!selectedCids.length);\n\t\t\tif (options.onSelect) {\n\t\t\t\toptions.onSelect({ cid: cid, selectedCids: selectedCids.slice() });\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t};\n\n\tfunction updateFilterButton(el, selectedCids) {\n\t\tif (selectedCids.length > 1) {\n\t\t\trenderButton({\n\t\t\t\ticon: 'fa-plus',\n\t\t\t\tname: '[[unread:multiple-categories-selected]]',\n\t\t\t\tbgColor: '#ddd',\n\t\t\t});\n\t\t} else if (selectedCids.length === 1) {\n\t\t\tapi.get(`/categories/${selectedCids[0]}`, {}).then(renderButton);\n\t\t} else {\n\t\t\trenderButton();\n\t\t}\n\t\tfunction renderButton(category) {\n\t\t\tapp.parseAndTranslate('partials/category-filter-content', {\n\t\t\t\tselectedCategory: category,\n\t\t\t}, function (html) {\n\t\t\t\tel.find('button').replaceWith($('<div/>').html(html).find('button'));\n\t\t\t});\n\t\t}\n\t}\n\n\treturn categoryFilter;\n});\n"]}