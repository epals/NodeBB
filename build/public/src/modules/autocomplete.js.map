{"version":3,"sources":["public/src/modules/autocomplete.js"],"names":["define","api","module","user","input","params","onselect","app","loadJQueryUI","autocomplete","delay","open","$","this","css","select","event","ui","handleOnSelect","source","request","response","query","term","get","err","result","alertError","message","users","names","map","username","html","text","label","value","uid","name","slug","userslug","picture","banned","icon:text","icon:bgColor","attr","group","socket","emit","results","length","tag","cid","ajaxify","data","tags","e","jQuery","Event","which","keyCode","setTimeout","trigger"],"mappings":"AACA,aAGAA,OAAO,gBAAiB,OAAQ,SAAUC,GACzC,IAAIC,KAEJA,EAAOC,KAAO,SAAUC,EAAOC,EAAQC,GACtC,UAAWD,IAAW,WAAY,CACjCC,EAAWD,EACXA,KAEDA,EAASA,MACTE,IAAIC,aAAa,WAChBJ,EAAMK,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,SAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAed,EAAOE,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1BhB,EAAOiB,MAAQF,EAAQG,KAEvBtB,EAAIuB,IAAI,aAAcnB,EAAQ,SAAUoB,EAAKC,GAC5C,GAAID,EAAK,CACR,OAAOlB,IAAIoB,WAAWF,EAAIG,SAG3B,GAAIF,GAAUA,EAAOG,MAAO,CAC3B,IAAIC,EAAQJ,EAAOG,MAAME,IAAI,SAAU5B,GACtC,IAAI6B,EAAWpB,EAAE,eAAeqB,KAAK9B,EAAK6B,UAAUE,OACpD,OAAO/B,IACNgC,MAAOH,EACPI,MAAOJ,EACP7B,MACCkC,IAAKlC,EAAKkC,IACVC,KAAMnC,EAAK6B,SACXO,KAAMpC,EAAKqC,SACXR,SAAU7B,EAAK6B,SACfQ,SAAUrC,EAAKqC,SACfC,QAAStC,EAAKsC,QACdC,OAAQvC,EAAKuC,OACbC,YAAaxC,EAAK,aAClByC,eAAgBzC,EAAK,oBAIxBkB,EAASS,GAGVlB,EAAE,sBAAsBiC,KAAK,eAAgB,iBAOlD3C,EAAO4C,MAAQ,SAAU1C,EAAOE,GAC/BC,IAAIC,aAAa,WAChBJ,EAAMK,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,SAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAed,EAAOE,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1B0B,OAAOC,KAAK,iBACX1B,MAAOF,EAAQG,MACb,SAAUE,EAAKwB,GACjB,GAAIxB,EAAK,CACR,OAAOlB,IAAIoB,WAAWF,EAAIG,SAE3B,GAAIqB,GAAWA,EAAQC,OAAQ,CAC9B,IAAIpB,EAAQmB,EAAQlB,IAAI,SAAUe,GACjC,OAAOA,IACNX,MAAOW,EAAMR,KACbF,MAAOU,EAAMR,KACbQ,MAAOA,KAGTzB,EAASS,GAEVlB,EAAE,sBAAsBiC,KAAK,eAAgB,iBAOlD3C,EAAOiD,IAAM,SAAU/C,EAAOE,GAC7BC,IAAIC,aAAa,WAChBJ,EAAMK,cACLC,MAAO,IACPC,KAAM,WACLC,EAAEC,MAAMJ,aAAa,UAAUK,IAAI,UAAW,MAE/CC,OAAQ,SAAUC,EAAOC,GACxBC,EAAed,EAAOE,EAAUU,EAAOC,IAExCE,OAAQ,SAAUC,EAASC,GAC1B0B,OAAOC,KAAK,2BACX1B,MAAOF,EAAQG,KACf6B,IAAKC,QAAQC,KAAKF,KAAO,GACvB,SAAU3B,EAAK8B,GACjB,GAAI9B,EAAK,CACR,OAAOlB,IAAIoB,WAAWF,EAAIG,SAE3B,GAAI2B,EAAM,CACTlC,EAASkC,GAEV3C,EAAE,sBAAsBiC,KAAK,eAAgB,iBAOlD,SAAS3B,EAAed,EAAOE,EAAUU,EAAOC,GAC/CX,EAAWA,GAAY,aACvB,IAAIkD,EAAIC,OAAOC,MAAM,YACrBF,EAAEG,MAAQ,GACVH,EAAEI,QAAU,GACZC,WAAW,WACVzD,EAAM0D,QAAQN,IACZ,KACHlD,EAASU,EAAOC,GAGjB,OAAOf","file":"public/src/modules/autocomplete.js","sourcesContent":["\n'use strict';\n\n\ndefine('autocomplete', ['api'], function (api) {\n\tvar module = {};\n\n\tmodule.user = function (input, params, onselect) {\n\t\tif (typeof params === 'function') {\n\t\t\tonselect = params;\n\t\t\tparams = {};\n\t\t}\n\t\tparams = params || {};\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 200,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 100005);\n\t\t\t\t},\n\t\t\t\tselect: function (event, ui) {\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\n\t\t\t\t},\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tparams.query = request.term;\n\n\t\t\t\t\tapi.get('/api/users', params, function (err, result) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (result && result.users) {\n\t\t\t\t\t\t\tvar names = result.users.map(function (user) {\n\t\t\t\t\t\t\t\tvar username = $('<div></div>').html(user.username).text();\n\t\t\t\t\t\t\t\treturn user && {\n\t\t\t\t\t\t\t\t\tlabel: username,\n\t\t\t\t\t\t\t\t\tvalue: username,\n\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\tuid: user.uid,\n\t\t\t\t\t\t\t\t\t\tname: user.username,\n\t\t\t\t\t\t\t\t\t\tslug: user.userslug,\n\t\t\t\t\t\t\t\t\t\tusername: user.username,\n\t\t\t\t\t\t\t\t\t\tuserslug: user.userslug,\n\t\t\t\t\t\t\t\t\t\tpicture: user.picture,\n\t\t\t\t\t\t\t\t\t\tbanned: user.banned,\n\t\t\t\t\t\t\t\t\t\t'icon:text': user['icon:text'],\n\t\t\t\t\t\t\t\t\t\t'icon:bgColor': user['icon:bgColor'],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresponse(names);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tmodule.group = function (input, onselect) {\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 200,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 100005);\n\t\t\t\t},\n\t\t\t\tselect: function (event, ui) {\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\n\t\t\t\t},\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tsocket.emit('groups.search', {\n\t\t\t\t\t\tquery: request.term,\n\t\t\t\t\t}, function (err, results) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (results && results.length) {\n\t\t\t\t\t\t\tvar names = results.map(function (group) {\n\t\t\t\t\t\t\t\treturn group && {\n\t\t\t\t\t\t\t\t\tlabel: group.name,\n\t\t\t\t\t\t\t\t\tvalue: group.name,\n\t\t\t\t\t\t\t\t\tgroup: group,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tresponse(names);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tmodule.tag = function (input, onselect) {\n\t\tapp.loadJQueryUI(function () {\n\t\t\tinput.autocomplete({\n\t\t\t\tdelay: 100,\n\t\t\t\topen: function () {\n\t\t\t\t\t$(this).autocomplete('widget').css('z-index', 20000);\n\t\t\t\t},\n\t\t\t\tselect: function (event, ui) {\n\t\t\t\t\thandleOnSelect(input, onselect, event, ui);\n\t\t\t\t},\n\t\t\t\tsource: function (request, response) {\n\t\t\t\t\tsocket.emit('topics.autocompleteTags', {\n\t\t\t\t\t\tquery: request.term,\n\t\t\t\t\t\tcid: ajaxify.data.cid || 0,\n\t\t\t\t\t}, function (err, tags) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (tags) {\n\t\t\t\t\t\t\tresponse(tags);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('.ui-autocomplete a').attr('data-ajaxify', 'false');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction handleOnSelect(input, onselect, event, ui) {\n\t\tonselect = onselect || function () { };\n\t\tvar e = jQuery.Event('keypress');\n\t\te.which = 13;\n\t\te.keyCode = 13;\n\t\tsetTimeout(function () {\n\t\t\tinput.trigger(e);\n\t\t}, 100);\n\t\tonselect(event, ui);\n\t}\n\n\treturn module;\n});\n"]}