{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/resize.js"],"names":["define","taskbar","resize","oldRatio","minimumRatio","snapMargin","mediumMin","$body","$","$window","window","$headerMenu","html","document","documentElement","body","header","getSavedRatio","localStorage","getItem","saveRatio","ratio","setItem","Math","min","getBounds","headerRect","getBoundingClientRect","bottom","headerBottom","max","rect","top","left","right","innerWidth","innerHeight","width","height","boundedTop","boundedHeight","doResize","postContainer","bounds","elem","style","getComputedStyle","minHeight","parseInt","getPropertyValue","adjustedMinimum","boundedDifference","toString","paddingBottom","removeAttr","visibility","updateActive","attr","resizeIt","raf","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","setTimeout","trigger","reposition","addClass","maximize","state","handleResize","resizeOffset","resizeBegin","resizeEnd","$resizer","find","resizer","resizeStart","e","resizeRect","resizeCenterY","clientY","on","resizeAction","resizeStop","resizeTouchAction","position","preventDefault","focus","off","hasClass","removeClass","touches"],"mappings":"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","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/resize.js","sourcesContent":["\n'use strict';\n\n/* globals define */\n\ndefine('composer/resize', ['taskbar'], function(taskbar) {\n\tvar resize = {};\n\tvar oldRatio = 0;\n\tvar minimumRatio = 0.3;\n\tvar snapMargin = 0.05;\n\tvar mediumMin = 992;\n\n\tvar $body = $('body');\n\tvar $window = $(window);\n\tvar $headerMenu = $('[component=\"navbar\"]');\n\n\tvar html = document.documentElement;\n\tvar body = document.body;\n\tvar header = $headerMenu[0];\n\n\tfunction getSavedRatio() {\n\t\treturn localStorage.getItem('composer:resizeRatio') || 0.5;\n\t}\n\n\tfunction saveRatio(ratio) {\n\t\tlocalStorage.setItem('composer:resizeRatio', Math.min(ratio, 1));\n\t}\n\n\tfunction getBounds() {\n\t\tvar headerRect;\n\t\tif (header) {\n\t\t\theaderRect = header.getBoundingClientRect();\n\t\t} else {\n\t\t\t// Mock data\n\t\t\theaderRect = { bottom: 0 };\n\t\t}\n\n\t\tvar headerBottom = Math.max(headerRect.bottom, 0);\n\n\t\tvar rect = {\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t\tright: window.innerWidth,\n\t\t\tbottom: window.innerHeight,\n\t\t};\n\n\t\trect.width = rect.right;\n\t\trect.height = rect.bottom;\n\n\t\trect.boundedTop = headerBottom;\n\t\trect.boundedHeight = rect.bottom - headerBottom;\n\n\t\treturn rect;\n\t}\n\n\tfunction doResize(postContainer, ratio) {\n\t\tvar bounds = getBounds();\n\t\tvar elem = postContainer[0];\n\t\tvar style = window.getComputedStyle(elem);\n\n\t\t// Adjust minimumRatio for shorter viewports\n\t\tvar minHeight = parseInt(style.getPropertyValue('min-height'), 10);\n\t\tvar adjustedMinimum = Math.max(minHeight / window.innerHeight, minimumRatio);\n\n\t\tif (bounds.width >= mediumMin) {\n\t\t\tconst boundedDifference = (bounds.height - bounds.boundedHeight) / bounds.height;\n\t\t\tratio = Math.min(Math.max(ratio, adjustedMinimum + boundedDifference), 1);\n\n\t\t\tvar top = ratio * bounds.boundedHeight / bounds.height;\n\t\t\telem.style.top = ((1 - top) * 100).toString() + '%';\n\n\t\t\t// Add some extra space at the bottom of the body so that\n\t\t\t// the user can still scroll to the last post w/ composer open\n\t\t\tvar rect = elem.getBoundingClientRect();\n\t\t\tbody.style.paddingBottom = (rect.bottom - rect.top).toString() + 'px';\n\t\t} else {\n\t\t\tpostContainer.removeAttr('style');\n\t\t\tbody.style.paddingBottom = 0;\n\t\t}\n\n\t\tpostContainer.ratio = ratio;\n\t\telem.style.visibility = 'visible';\n\n\t\ttaskbar.updateActive(postContainer.attr('data-uuid'));\n\t}\n\n\tvar resizeIt = doResize;\n\tvar raf = window.requestAnimationFrame ||\n\t\twindow.webkitRequestAnimationFrame ||\n\t\twindow.mozRequestAnimationFrame;\n\n\tif (raf) {\n\t\tresizeIt = function(postContainer, ratio) {\n\t\t\traf(function() {\n\t\t\t\tdoResize(postContainer, ratio);\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t$window.trigger('action:composer.resize');\n\t\t\t\t\tpostContainer.trigger('action:composer.resize');\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t};\n\t}\n\n\tresize.reposition = function(postContainer) {\n\t\tvar\tratio = getSavedRatio();\n\n\t\tif (ratio >= 1 - snapMargin) {\n\t\t\tratio = 1;\n\t\t\tpostContainer.addClass('maximized');\n\t\t}\n\n\t\tresizeIt(postContainer, ratio);\n\t};\n\n\tresize.maximize = function(postContainer, state) {\n\t\tif (state) {\n\t\t\tresizeIt(postContainer, 1);\n\t\t} else {\n\t\t\tresize.reposition(postContainer);\n\t\t}\n\t};\n\n\tresize.handleResize = function(postContainer) {\n\t\tvar resizeOffset = 0;\n\t\tvar resizeBegin = 0;\n\t\tvar resizeEnd = 0;\n\t\tvar $resizer = postContainer.find('.resizer');\n\t\tvar resizer = $resizer[0];\n\n\t\tfunction resizeStart(e) {\n\t\t\tvar resizeRect = resizer.getBoundingClientRect();\n\t\t\tvar resizeCenterY = (resizeRect.top + resizeRect.bottom) / 2;\n\n\t\t\tresizeOffset = (resizeCenterY - e.clientY) / 2;\n\t\t\tresizeBegin = e.clientY;\n\n\t\t\t$window.on('mousemove', resizeAction);\n\t\t\t$window.on('mouseup', resizeStop);\n\t\t\t$body.on('touchmove', resizeTouchAction);\n\t\t}\n\n\t\tfunction resizeAction(e) {\n\t\t\tvar position = e.clientY - resizeOffset;\n\t\t\tvar bounds = getBounds();\n\t\t\tvar ratio = (bounds.height - position) / (bounds.boundedHeight);\n\n\t\t\tresizeIt(postContainer, ratio);\n\t\t}\n\n\t\tfunction resizeStop(e) {\n\t\t\te.preventDefault();\n\t\t\tresizeEnd = e.clientY;\n\n\t\t\tpostContainer.find('textarea').focus();\n\t\t\t$window.off('mousemove', resizeAction);\n\t\t\t$window.off('mouseup', resizeStop);\n\t\t\t$body.off('touchmove', resizeTouchAction);\n\n\t\t\tvar position = resizeEnd - resizeOffset;\n\t\t\tvar bounds = getBounds();\n\t\t\tvar ratio = (bounds.height - position) / (bounds.boundedHeight);\n\n\t\t\tif (resizeEnd - resizeBegin === 0 && postContainer.hasClass('maximized')) {\n\t\t\t\tpostContainer.removeClass('maximized');\n\t\t\t\tratio = (!oldRatio || oldRatio >= 1 - snapMargin) ? 0.5 : oldRatio;\n\t\t\t\tresizeIt(postContainer, ratio);\n\t\t\t} else if (resizeEnd - resizeBegin === 0 || ratio >= 1 - snapMargin) {\n\t\t\t\tresizeIt(postContainer, 1);\n\t\t\t\tpostContainer.addClass('maximized');\n\t\t\t\toldRatio = ratio;\n\t\t\t} else {\n\t\t\t\tpostContainer.removeClass('maximized');\n\t\t\t}\n\n\t\t\tsaveRatio(ratio);\n\t\t}\n\n\t\tfunction resizeTouchAction(e) {\n\t\t\te.preventDefault();\n\t\t\tresizeAction(e.touches[0]);\n\t\t}\n\n\t\t$resizer\n\t\t\t.on('mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tresizeStart(e);\n\t\t\t})\n\t\t\t.on('touchstart', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tresizeStart(e.touches[0]);\n\t\t\t})\n\t\t\t.on('touchend', resizeStop);\n\t};\n\n\treturn resize;\n});\n"]}