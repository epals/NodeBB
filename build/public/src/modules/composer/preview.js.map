{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/preview.js"],"names":["define","hooks","preview","timeoutId","render","postContainer","callback","find","is","clearTimeout","textarea","setTimeout","socket","emit","val","err","$","addClass","html","fire","matchScroll","length","diff","scrollHeight","height","scrollPercent","scrollTop","Math","max","handleToggler","env","utils","findBootstrapEnvironment","showBtn","hideBtn","previewContainer","writeContainer","hidePreview","togglePreview","localStorage","setItem","showPreview","removeItem","show","toggleClass","toggle","on","focus","getItem"],"mappings":"AAAA,aAIAA,OAAO,oBAAqB,SAAU,SAAUC,GAC/C,IAAIC,KAEJ,IAAIC,EAAY,EAEhBD,EAAQE,OAAS,SAAUC,EAAeC,GACzCA,EAAWA,GAAY,aACvB,IAAKD,EAAcE,KAAK,sBAAsBC,GAAG,YAAa,CAC7D,OAAOF,IAGR,GAAIH,EAAW,CACdM,aAAaN,GACbA,EAAY,EAEb,IAAIO,EAAWL,EAAcE,KAAK,YAElCJ,EAAYQ,WAAW,WACtBC,OAAOC,KAAK,iCAAkCH,EAASI,MAAO,SAAUC,EAAKb,GAC5EC,EAAY,EACZ,GAAIY,EAAK,CACR,OAEDb,EAAUc,EAAE,QAAUd,EAAU,UAChCA,EAAQK,KAAK,4BAA4BU,SAAS,kBAClDZ,EAAcE,KAAK,YAAYW,KAAKhB,GACpCD,EAAMkB,KAAK,2BACXb,OAEC,MAGJJ,EAAQkB,YAAc,SAAUf,GAC/B,IAAKA,EAAcE,KAAK,sBAAsBC,GAAG,YAAa,CAC7D,OAED,IAAIE,EAAWL,EAAcE,KAAK,YAClC,IAAIL,EAAUG,EAAcE,KAAK,YAEjC,GAAIG,EAASW,QAAUnB,EAAQmB,OAAQ,CACtC,IAAIC,EAAOZ,EAAS,GAAGa,aAAeb,EAASc,SAE/C,GAAIF,IAAS,EAAG,CACf,OAGD,IAAIG,EAAgBf,EAASgB,YAAcJ,EAE3CpB,EAAQwB,UAAUC,KAAKC,IAAI1B,EAAQ,GAAGqB,aAAerB,EAAQsB,SAAU,GAAKC,KAI9EvB,EAAQ2B,cAAgB,SAAUxB,GACjCH,EAAQ4B,IAAMC,MAAMC,2BACpB,IAAIC,EAAU5B,EAAcE,KAAK,oCACjC,IAAI2B,EAAU7B,EAAcE,KAAK,sCACjC,IAAI4B,EAAmBnB,EAAE,sBACzB,IAAIoB,EAAiBpB,EAAE,oBAEvB,SAASqB,IACRC,EAAc,OACd,GAAIpC,EAAQ4B,MAAQ,MAAQ5B,EAAQ4B,MAAQ,KAAM,CACjDS,aAAaC,QAAQ,0BAA2B,OAIlD,SAASC,IACRH,EAAc,MACd,GAAIpC,EAAQ4B,MAAQ,MAAQ5B,EAAQ4B,MAAQ,KAAM,CACjDS,aAAaG,WAAW,4BAI1B,SAASJ,EAAcK,GACtB,GAAIzC,EAAQ4B,MAAQ,MAAQ5B,EAAQ4B,MAAQ,KAAM,CACjDK,EAAiBS,YAAY,OAAQ,OACrCR,EAAeQ,YAAY,YAAa,OACxCX,EAAQW,YAAY,OAAQ,MAC5BT,EAAiBS,YAAY,uBAAwBD,GACrDP,EAAeQ,YAAY,sBAAuBD,GAGlD,GAAIA,EAAM,CACTzC,EAAQE,OAAOC,EAAe,mBAEzB,CACN8B,EAAiBS,YAAY,QAASD,GACtCP,EAAeQ,YAAY,aAAcD,GACzCV,EAAQW,YAAY,OAAQD,GAG7BzC,EAAQkB,YAAYf,GAErBH,EAAQ2C,OAASP,EAEjBJ,EAAQY,GAAG,QAAS,WACnBT,IACAhC,EAAcE,KAAK,UAAUwC,UAE9Bd,EAAQa,GAAG,QAAS,WACnBL,IACApC,EAAcE,KAAK,UAAUwC,UAG9B,GAAIR,aAAaS,QAAQ,6BAA+B9C,EAAQ4B,MAAQ,MAAQ5B,EAAQ4B,MAAQ,MAAO,CACtGO,QACM,CACNI,MAIF,OAAOvC","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/preview.js","sourcesContent":["'use strict';\n\n/* globals define, socket, $, window, utils, localStorage */\n\ndefine('composer/preview', ['hooks'], function (hooks) {\n\tvar preview = {};\n\n\tvar timeoutId = 0;\n\n\tpreview.render = function (postContainer, callback) {\n\t\tcallback = callback || function () {};\n\t\tif (!postContainer.find('.preview-container').is(':visible')) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tif (timeoutId) {\n\t\t\tclearTimeout(timeoutId);\n\t\t\ttimeoutId = 0;\n\t\t}\n\t\tvar textarea = postContainer.find('textarea');\n\n\t\ttimeoutId = setTimeout(function () {\n\t\t\tsocket.emit('plugins.composer.renderPreview', textarea.val(), function (err, preview) {\n\t\t\t\ttimeoutId = 0;\n\t\t\t\tif (err) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpreview = $('<div>' + preview + '</div>');\n\t\t\t\tpreview.find('img:not(.not-responsive)').addClass('img-responsive');\n\t\t\t\tpostContainer.find('.preview').html(preview);\n\t\t\t\thooks.fire('action:composer.preview');\n\t\t\t\tcallback();\n\t\t\t});\n\t\t}, 250);\n\t};\n\n\tpreview.matchScroll = function (postContainer) {\n\t\tif (!postContainer.find('.preview-container').is(':visible')) {\n\t\t\treturn;\n\t\t}\n\t\tvar textarea = postContainer.find('textarea');\n\t\tvar preview = postContainer.find('.preview');\n\n\t\tif (textarea.length && preview.length) {\n\t\t\tvar diff = textarea[0].scrollHeight - textarea.height();\n\n\t\t\tif (diff === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar scrollPercent = textarea.scrollTop() / diff;\n\n\t\t\tpreview.scrollTop(Math.max(preview[0].scrollHeight - preview.height(), 0) * scrollPercent);\n\t\t}\n\t};\n\n\tpreview.handleToggler = function (postContainer) {\n\t\tpreview.env = utils.findBootstrapEnvironment();\n\t\tvar showBtn = postContainer.find('.write-container .toggle-preview');\n\t\tvar hideBtn = postContainer.find('.preview-container .toggle-preview');\n\t\tvar previewContainer = $('.preview-container');\n\t\tvar writeContainer = $('.write-container');\n\n\t\tfunction hidePreview() {\n\t\t\ttogglePreview(false);\n\t\t\tif (preview.env !== 'xs' && preview.env !== 'sm') {\n\t\t\t\tlocalStorage.setItem('composer:previewToggled', true);\n\t\t\t}\n\t\t}\n\n\t\tfunction showPreview() {\n\t\t\ttogglePreview(true);\n\t\t\tif (preview.env !== 'xs' && preview.env !== 'sm') {\n\t\t\t\tlocalStorage.removeItem('composer:previewToggled');\n\t\t\t}\n\t\t}\n\n\t\tfunction togglePreview(show) {\n\t\t\tif (preview.env === 'xs' || preview.env === 'sm') {\n\t\t\t\tpreviewContainer.toggleClass('hide', false);\n\t\t\t\twriteContainer.toggleClass('maximized', false);\n\t\t\t\tshowBtn.toggleClass('hide', true);\n\t\t\t\tpreviewContainer.toggleClass('hidden-xs hidden-sm', !show);\n\t\t\t\twriteContainer.toggleClass('hidden-xs hidden-sm', show);\n\n\t\t\t\t// Render preview once on mobile\n\t\t\t\tif (show) {\n\t\t\t\t\tpreview.render(postContainer, function () {});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpreviewContainer.toggleClass('hide', !show);\n\t\t\t\twriteContainer.toggleClass('maximized', !show);\n\t\t\t\tshowBtn.toggleClass('hide', show);\n\t\t\t}\n\n\t\t\tpreview.matchScroll(postContainer);\n\t\t}\n\t\tpreview.toggle = togglePreview;\n\n\t\thideBtn.on('click', function () {\n\t\t\thidePreview();\n\t\t\tpostContainer.find('.write').focus();\n\t\t});\n\t\tshowBtn.on('click', function () {\n\t\t\tshowPreview();\n\t\t\tpostContainer.find('.write').focus();\n\t\t});\n\n\t\tif (localStorage.getItem('composer:previewToggled') || (preview.env === 'xs' || preview.env === 'sm')) {\n\t\t\thidePreview();\n\t\t} else {\n\t\t\tshowPreview();\n\t\t}\n\t};\n\n\treturn preview;\n});\n"]}