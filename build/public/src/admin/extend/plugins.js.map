{"version":3,"sources":["public/src/admin/extend/plugins.js"],"names":["define","translator","Benchpress","Plugins","init","pluginsList","$","numPlugins","querySelectorAll","length","pluginID","translate","html","append","searchInputEl","document","querySelector","value","on","pluginEl","this","parents","attr","btn","pluginData","ajaxify","data","installed","toggleActivate","socket","emit","err","status","app","alertError","active","buttonText","toggleClass","prepend","clone","alert","alert_id","title","message","type","timeout","clickfn","require","instance","rebuildAndRestart","license","render","then","bootbox","dialog","size","buttons","cancel","label","className","save","callback","toggleInstall","suggest","payload","confirm","compile","responseText","removeAttr","version","confirmInstall","parent","compareVersions","currentVersion","find","text","compare","upgrade","config","term","val","each","pluginId","indexOf","submitPluginUsage","prop","modal","activePlugins","forEach","plugin","sortable","list","item","prev","before","next","after","plugins","children","index","el","push","name","order","populateUpgradeablePlugins","populateActivePlugins","focus","id","isActive","remove","refresh","apply","arguments","nbbVersion","match","ajax","registry","package","dataType","done","undefined","fail","hasClass"],"mappings":"AAAA,aAGAA,OAAO,wBACN,aACA,aACA,8BACE,SAAUC,EAAYC,GACxB,IAAIC,KACJA,EAAQC,KAAO,WACd,IAAIC,EAAcC,EAAE,YACpB,IAAIC,EAAaF,EAAY,GAAGG,iBAAiB,MAAMC,OACvD,IAAIC,EAEJ,IAAKH,EAAY,CAChBN,EAAWU,UAAU,6DAA8D,SAAUC,GAC5FP,EAAYQ,OAAOD,KAEpB,OAGD,MAAME,EAAgBC,SAASC,cAAc,kBAC7CF,EAAcG,MAAQ,GAEtBZ,EAAYa,GAAG,QAAS,qCAAsC,WAC7D,IAAIC,EAAWb,EAAEc,MAAMC,QAAQ,MAC/BX,EAAWS,EAASG,KAAK,kBACzB,IAAIC,EAAMjB,EAAE,QAAUI,EAAW,mCAEjC,IAAIc,EAAaC,QAAQC,KAAKC,UAAUR,EAASG,KAAK,sBAEtD,SAASM,IACRC,OAAOC,KAAK,6BAA8BpB,EAAU,SAAUqB,EAAKC,GAClE,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,GAEvB9B,EAAWU,UAAU,uEAAyEqB,EAAOG,OAAS,aAAe,YAAc,KAAM,SAAUC,GAC1Jb,EAAIX,KAAKwB,GACTb,EAAIc,YAAY,cAAeL,EAAOG,QAAQE,YAAY,eAAgBL,EAAOG,QAGjF,GAAIH,EAAOG,SAAW7B,EAAE,gBAAkBI,EAAW,MAAMD,OAAQ,CAClEH,EAAE,cAAcgC,QAAQnB,EAASoB,MAAM,OAIxCf,EAAWW,QAAUX,EAAWW,OAEhCF,IAAIO,OACHC,SAAU,iBACVC,MAAO,iCAAmCV,EAAOG,OAAS,UAAY,YAAc,KACpFQ,QAAS,iCAAmCX,EAAOG,OAAS,mBAAqB,sBAAwB,KACzGS,KAAMZ,EAAOG,OAAS,UAAY,UAClCU,QAAS,IACTC,QAAS,WACRC,SAAS,0BAA2B,SAAUC,GAC7CA,EAASC,6BAQf,GAAIzB,EAAW0B,SAAW1B,EAAWW,SAAW,KAAM,CACrDjC,EAAWiD,OAAO,iCAAkC3B,GAAY4B,KAAK,SAAUxC,GAC9EyC,QAAQC,QACPZ,MAAO,yCACPC,QAAS/B,EACT2C,KAAM,QACNC,SACCC,QACCC,MAAO,6BACPC,UAAW,YAEZC,MACCF,MAAO,8BACPC,UAAW,cACXE,SAAUjC,YAKR,CACNA,EAAelB,MAIjBL,EAAYa,GAAG,QAAS,sCAAuC,WAC9D,IAAIK,EAAMjB,EAAEc,MACZG,EAAID,KAAK,WAAY,MACrBZ,EAAWJ,EAAEc,MAAMC,QAAQ,MAAMC,KAAK,kBAEtC,GAAIhB,EAAEc,MAAME,KAAK,oBAAsB,IAAK,CAC3C,OAAOnB,EAAQ2D,cAAcpD,EAAUJ,EAAEc,MAAMC,QAAQ,MAAMC,KAAK,iBAGnEnB,EAAQ4D,QAAQrD,EAAU,SAAUqB,EAAKiC,GACxC,GAAIjC,EAAK,CACRsB,QAAQY,QAAQhE,EAAWiE,QAAQ,2CAA4CnC,EAAIC,OAAQD,EAAIoC,cAAe,SAAUF,GACvH,GAAIA,EAAS,CACZ9D,EAAQ2D,cAAcpD,EAAU,cAC1B,CACNa,EAAI6C,WAAW,eAGjB,OAGD,GAAIJ,EAAQK,UAAY,SAAU,CACjClE,EAAQ2D,cAAcpD,EAAUsD,EAAQK,cAClC,GAAIL,EAAQK,UAAY,SAAU,CACxCC,EAAe5D,EAAU,SAAUuD,GAClC,GAAIA,EAAS,CACZ9D,EAAQ2D,cAAcpD,EAAU,cAC1B,CACNa,EAAI6C,WAAW,mBAGX,CACN7C,EAAI6C,WAAW,iBAKlB/D,EAAYa,GAAG,QAAS,gCAAiC,WACxD,IAAIK,EAAMjB,EAAEc,MACZ,IAAImD,EAAShD,EAAIF,QAAQ,MACzBX,EAAW6D,EAAOjD,KAAK,kBAEvBnB,EAAQ4D,QAAQrD,EAAU,SAAUqB,EAAKiC,GACxC,GAAIjC,EAAK,CACR,OAAOsB,QAAQb,MAAM,8DAGtBO,SAAS,oBAAqB,SAAUyB,GACvC,IAAIC,EAAiBF,EAAOG,KAAK,mBAAmBC,OACpD,GAAIX,EAAQK,UAAY,UAAYG,EAAgBI,QAAQZ,EAAQK,QAASI,EAAgB,KAAM,CAClGI,EAAQnE,EAAUa,EAAKyC,EAAQK,cACzB,GAAIL,EAAQK,UAAY,SAAU,CACxCC,EAAe5D,EAAU,WACxBmE,EAAQnE,EAAUa,EAAKyC,EAAQK,eAE1B,CACNhB,QAAQb,MAAMvC,EAAWiE,QAAQ,0CAA2CjC,IAAI6C,OAAOT,QAASL,EAAQK,iBAM5G/D,EAAEQ,GAAeI,GAAG,uBAAwB,WAC3C,IAAI6D,EAAOzE,EAAEc,MAAM4D,MACnB1E,EAAE,eAAe2E,KAAK,WACrB,IAAIC,EAAW5E,EAAEc,MAAME,KAAK,kBAC5BhB,EAAEc,MAAMiB,YAAY,OAAQ6C,GAAYA,EAASC,QAAQJ,MAAW,OAItEzE,EAAE,wBAAwBY,GAAG,QAAS,WACrCW,OAAOC,KAAK,4BACXsD,kBAAmB9E,EAAEc,MAAMiE,KAAK,WAAa,IAAM,KACjD,SAAUtD,GACZ,GAAIA,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAIY,cAK7BrC,EAAE,iBAAiBY,GAAG,QAAS,WAC9BZ,EAAE,+BAA+BgF,MAAM,QACvCzD,OAAOC,KAAK,0BAA2B,SAAUC,EAAKwD,GACrD,GAAIxD,EAAK,CACR,OAAOE,IAAIC,WAAWH,GAEvB,IAAInB,EAAO,GACX2E,EAAcC,QAAQ,SAAUC,GAC/B7E,GAAQ,gBAAkB6E,EAAS,4GAEpC,IAAKF,EAAc9E,OAAQ,CAC1BR,EAAWU,UAAU,uCAAwC,SAAUgE,GACtErE,EAAE,4CAA4CM,KAAK+D,GAAMe,aAE1D,OAED,IAAIC,EAAOrF,EAAE,4CACbqF,EAAK/E,KAAKA,GAAM8E,WAEhBC,EAAKjB,KAAK,kBAAkBxD,GAAG,QAAS,WACvC,IAAI0E,EAAOtF,EAAEc,MAAMC,QAAQ,MAC3BuE,EAAKC,OAAOC,OAAOF,KAGpBD,EAAKjB,KAAK,oBAAoBxD,GAAG,QAAS,WACzC,IAAI0E,EAAOtF,EAAEc,MAAMC,QAAQ,MAC3BuE,EAAKG,OAAOC,MAAMJ,SAKrBtF,EAAE,sBAAsBY,GAAG,QAAS,WACnC,IAAI+E,EAAU3F,EAAE,4CAA4C4F,WAC5D,IAAIxE,KACJuE,EAAQhB,KAAK,SAAUkB,EAAOC,GAC7B1E,EAAK2E,MAAOC,KAAMhG,EAAE8F,GAAIzB,OAAQ4B,MAAOJ,MAGxCtE,OAAOC,KAAK,mCAAoCJ,EAAM,SAAUK,GAC/D,GAAIA,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAIY,SAE3BrC,EAAE,+BAA+BgF,MAAM,QAEvCrD,IAAIO,OACHC,SAAU,mBACVC,MAAO,yCACPC,QAAS,iDACTC,KAAM,UACNC,QAAS,IACTC,QAAS,WACRC,SAAS,0BAA2B,SAAUC,GAC7CA,EAASC,6BAOduD,IACAC,IACA3F,EAAc4F,SAGf,SAASpC,EAAe5D,EAAUmD,GACjCR,QAAQY,QAAQhE,EAAWiE,QAAQ,mDAAoDxD,GAAW,SAAUuD,GAC3GJ,EAASI,KAIX,SAASY,EAAQnE,EAAUa,EAAK8C,GAC/B9C,EAAID,KAAK,WAAY,MAAMoD,KAAK,KAAKpD,KAAK,QAAS,yBACnDO,OAAOC,KAAK,yBACX6E,GAAIjG,EACJ2D,QAASA,GACP,SAAUtC,EAAK6E,GACjB,GAAI7E,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAIY,SAE3B,IAAI4B,EAAShD,EAAIF,QAAQ,MACzBkD,EAAOG,KAAK,4BAA4BmC,SACxCtC,EAAOG,KAAK,mBAAmBC,KAAKN,GACpC9C,EAAIsF,SACJ,GAAID,EAAU,CACb3E,IAAIO,OACHC,SAAU,kBACVC,MAAO,0CACPC,QAAS,iDACTC,KAAM,UACNC,QAAS,IACTC,QAAS,WACRC,SAAS,0BAA2B,SAAUC,GAC7CA,EAASC,4BAQf9C,EAAQ2D,cAAgB,SAAUpD,EAAU2D,EAASR,GACpD,IAAItC,EAAMjB,EAAE,sBAAwBI,EAAW,0CAC/Ca,EAAImD,KAAK,KAAKpD,KAAK,QAAS,yBAE5BO,OAAOC,KAAK,+BACX6E,GAAIjG,EACJ2D,QAASA,GACP,SAAUtC,EAAKP,GACjB,GAAIO,EAAK,CACRR,EAAI6C,WAAW,YACf,OAAOnC,IAAIC,WAAWH,EAAIY,SAG3BlB,QAAQqF,UAER7E,IAAIO,OACHC,SAAU,iBACVC,MAAO,iCAAmClB,EAAWG,UAAY,YAAc,eAAiB,KAChGgB,QAAS,iCAAmCnB,EAAWG,UAAY,kBAAoB,qBAAuB,KAC9GiB,KAAM,OACNC,QAAS,MAGV,UAAWgB,IAAa,WAAY,CACnCA,EAASkD,MAAM3F,KAAM4F,eAKxB7G,EAAQ4D,QAAU,SAAUmB,EAAUrB,GACrC,IAAIoD,EAAahF,IAAI6C,OAAOT,QAAQ6C,MAAM,kBAC1C5G,EAAE6G,MAAMlF,IAAI6C,OAAOsC,UAAY,+BAAiC,mBAC/DxE,KAAM,MACNlB,MACC2F,QAASnC,EACTb,QAAS4C,EAAW,IAErBK,SAAU,SACRC,KAAK,SAAUvD,GACjBH,EAAS2D,UAAWxD,KAClByD,KAAK5D,IAGT,SAAS2C,IACRlG,EAAE,oBAAoB2E,KAAK,WAC1B,GAAI3E,EAAEc,MAAM8E,SAAS,2BAA2BzF,OAAQ,CACvDH,EAAE,eAAeO,OAAOP,EAAEc,MAAMmB,MAAM,UAKzC,SAASkE,IACRnG,EAAE,oBAAoB2E,KAAK,WAC1B,GAAI3E,EAAEc,MAAMsG,SAAS,UAAW,CAC/BpH,EAAE,cAAcO,OAAOP,EAAEc,MAAMmB,MAAM,WAC/B,CACNjC,EAAE,gBAAgBO,OAAOP,EAAEc,MAAMmB,MAAM,UAK1C,OAAOpC","file":"public/src/admin/extend/plugins.js","sourcesContent":["'use strict';\n\n\ndefine('admin/extend/plugins', [\n\t'translator',\n\t'benchpress',\n\t'jquery-ui/widgets/sortable',\n], function (translator, Benchpress) {\n\tvar Plugins = {};\n\tPlugins.init = function () {\n\t\tvar pluginsList = $('.plugins');\n\t\tvar numPlugins = pluginsList[0].querySelectorAll('li').length;\n\t\tvar pluginID;\n\n\t\tif (!numPlugins) {\n\t\t\ttranslator.translate('<li><p><i>[[admin/extend/plugins:none-found]]</i></p></li>', function (html) {\n\t\t\t\tpluginsList.append(html);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst searchInputEl = document.querySelector('#plugin-search');\n\t\tsearchInputEl.value = '';\n\n\t\tpluginsList.on('click', 'button[data-action=\"toggleActive\"]', function () {\n\t\t\tvar pluginEl = $(this).parents('li');\n\t\t\tpluginID = pluginEl.attr('data-plugin-id');\n\t\t\tvar btn = $('[id=\"' + pluginID + '\"] [data-action=\"toggleActive\"]');\n\n\t\t\tvar pluginData = ajaxify.data.installed[pluginEl.attr('data-plugin-index')];\n\n\t\t\tfunction toggleActivate() {\n\t\t\t\tsocket.emit('admin.plugins.toggleActive', pluginID, function (err, status) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t\t}\n\t\t\t\t\ttranslator.translate('<i class=\"fa fa-power-off\"></i> [[admin/extend/plugins:plugin-item.' + (status.active ? 'deactivate' : 'activate') + ']]', function (buttonText) {\n\t\t\t\t\t\tbtn.html(buttonText);\n\t\t\t\t\t\tbtn.toggleClass('btn-warning', status.active).toggleClass('btn-success', !status.active);\n\n\t\t\t\t\t\t// clone it to active plugins tab\n\t\t\t\t\t\tif (status.active && !$('#active [id=\"' + pluginID + '\"]').length) {\n\t\t\t\t\t\t\t$('#active ul').prepend(pluginEl.clone(true));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Toggle active state in template data\n\t\t\t\t\t\tpluginData.active = !pluginData.active;\n\n\t\t\t\t\t\tapp.alert({\n\t\t\t\t\t\t\talert_id: 'plugin_toggled',\n\t\t\t\t\t\t\ttitle: '[[admin/extend/plugins:alert.' + (status.active ? 'enabled' : 'disabled') + ']]',\n\t\t\t\t\t\t\tmessage: '[[admin/extend/plugins:alert.' + (status.active ? 'activate-success' : 'deactivate-success') + ']]',\n\t\t\t\t\t\t\ttype: status.active ? 'warning' : 'success',\n\t\t\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\t\t\tclickfn: function () {\n\t\t\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\n\t\t\t\t\t\t\t\t\tinstance.rebuildAndRestart();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (pluginData.license && pluginData.active !== true) {\n\t\t\t\tBenchpress.render('admin/partials/plugins/license', pluginData).then(function (html) {\n\t\t\t\t\tbootbox.dialog({\n\t\t\t\t\t\ttitle: '[[admin/extend/plugins:license.title]]',\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\tsize: 'large',\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tcancel: {\n\t\t\t\t\t\t\t\tlabel: '[[modules:bootbox.cancel]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsave: {\n\t\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\t\tcallback: toggleActivate,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\ttoggleActivate(pluginID);\n\t\t\t}\n\t\t});\n\n\t\tpluginsList.on('click', 'button[data-action=\"toggleInstall\"]', function () {\n\t\t\tvar btn = $(this);\n\t\t\tbtn.attr('disabled', true);\n\t\t\tpluginID = $(this).parents('li').attr('data-plugin-id');\n\n\t\t\tif ($(this).attr('data-installed') === '1') {\n\t\t\t\treturn Plugins.toggleInstall(pluginID, $(this).parents('li').attr('data-version'));\n\t\t\t}\n\n\t\t\tPlugins.suggest(pluginID, function (err, payload) {\n\t\t\t\tif (err) {\n\t\t\t\t\tbootbox.confirm(translator.compile('admin/extend/plugins:alert.suggest-error', err.status, err.responseText), function (confirm) {\n\t\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\t\tPlugins.toggleInstall(pluginID, 'latest');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbtn.removeAttr('disabled');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (payload.version !== 'latest') {\n\t\t\t\t\tPlugins.toggleInstall(pluginID, payload.version);\n\t\t\t\t} else if (payload.version === 'latest') {\n\t\t\t\t\tconfirmInstall(pluginID, function (confirm) {\n\t\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\t\tPlugins.toggleInstall(pluginID, 'latest');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbtn.removeAttr('disabled');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tbtn.removeAttr('disabled');\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tpluginsList.on('click', 'button[data-action=\"upgrade\"]', function () {\n\t\t\tvar btn = $(this);\n\t\t\tvar parent = btn.parents('li');\n\t\t\tpluginID = parent.attr('data-plugin-id');\n\n\t\t\tPlugins.suggest(pluginID, function (err, payload) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn bootbox.alert('[[admin/extend/plugins:alert.package-manager-unreachable]]');\n\t\t\t\t}\n\n\t\t\t\trequire(['compare-versions'], function (compareVersions) {\n\t\t\t\t\tvar currentVersion = parent.find('.currentVersion').text();\n\t\t\t\t\tif (payload.version !== 'latest' && compareVersions.compare(payload.version, currentVersion, '>')) {\n\t\t\t\t\t\tupgrade(pluginID, btn, payload.version);\n\t\t\t\t\t} else if (payload.version === 'latest') {\n\t\t\t\t\t\tconfirmInstall(pluginID, function () {\n\t\t\t\t\t\t\tupgrade(pluginID, btn, payload.version);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbootbox.alert(translator.compile('admin/extend/plugins:alert.incompatible', app.config.version, payload.version));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$(searchInputEl).on('input propertychange', function () {\n\t\t\tvar term = $(this).val();\n\t\t\t$('.plugins li').each(function () {\n\t\t\t\tvar pluginId = $(this).attr('data-plugin-id');\n\t\t\t\t$(this).toggleClass('hide', pluginId && pluginId.indexOf(term) === -1);\n\t\t\t});\n\t\t});\n\n\t\t$('#plugin-submit-usage').on('click', function () {\n\t\t\tsocket.emit('admin.config.setMultiple', {\n\t\t\t\tsubmitPluginUsage: $(this).prop('checked') ? '1' : '0',\n\t\t\t}, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('#plugin-order').on('click', function () {\n\t\t\t$('#order-active-plugins-modal').modal('show');\n\t\t\tsocket.emit('admin.plugins.getActive', function (err, activePlugins) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\t\t\t\tvar html = '';\n\t\t\t\tactivePlugins.forEach(function (plugin) {\n\t\t\t\t\thtml += '<li class=\"\">' + plugin + '<span class=\"pull-right\"><i class=\"fa fa-chevron-up\"></i><i class=\"fa fa-chevron-down\"></i></span></li>';\n\t\t\t\t});\n\t\t\t\tif (!activePlugins.length) {\n\t\t\t\t\ttranslator.translate('[[admin/extend/plugins:none-active]]', function (text) {\n\t\t\t\t\t\t$('#order-active-plugins-modal .plugin-list').html(text).sortable();\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar list = $('#order-active-plugins-modal .plugin-list');\n\t\t\t\tlist.html(html).sortable();\n\n\t\t\t\tlist.find('.fa-chevron-up').on('click', function () {\n\t\t\t\t\tvar item = $(this).parents('li');\n\t\t\t\t\titem.prev().before(item);\n\t\t\t\t});\n\n\t\t\t\tlist.find('.fa-chevron-down').on('click', function () {\n\t\t\t\t\tvar item = $(this).parents('li');\n\t\t\t\t\titem.next().after(item);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('#save-plugin-order').on('click', function () {\n\t\t\tvar plugins = $('#order-active-plugins-modal .plugin-list').children();\n\t\t\tvar data = [];\n\t\t\tplugins.each(function (index, el) {\n\t\t\t\tdata.push({ name: $(el).text(), order: index });\n\t\t\t});\n\n\t\t\tsocket.emit('admin.plugins.orderActivePlugins', data, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\t$('#order-active-plugins-modal').modal('hide');\n\n\t\t\t\tapp.alert({\n\t\t\t\t\talert_id: 'plugin_reordered',\n\t\t\t\t\ttitle: '[[admin/extend/plugins:alert.reorder]]',\n\t\t\t\t\tmessage: '[[admin/extend/plugins:alert.reorder-success]]',\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\tclickfn: function () {\n\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\n\t\t\t\t\t\t\tinstance.rebuildAndRestart();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tpopulateUpgradeablePlugins();\n\t\tpopulateActivePlugins();\n\t\tsearchInputEl.focus();\n\t};\n\n\tfunction confirmInstall(pluginID, callback) {\n\t\tbootbox.confirm(translator.compile('admin/extend/plugins:alert.possibly-incompatible', pluginID), function (confirm) {\n\t\t\tcallback(confirm);\n\t\t});\n\t}\n\n\tfunction upgrade(pluginID, btn, version) {\n\t\tbtn.attr('disabled', true).find('i').attr('class', 'fa fa-refresh fa-spin');\n\t\tsocket.emit('admin.plugins.upgrade', {\n\t\t\tid: pluginID,\n\t\t\tversion: version,\n\t\t}, function (err, isActive) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tvar parent = btn.parents('li');\n\t\t\tparent.find('.fa-exclamation-triangle').remove();\n\t\t\tparent.find('.currentVersion').text(version);\n\t\t\tbtn.remove();\n\t\t\tif (isActive) {\n\t\t\t\tapp.alert({\n\t\t\t\t\talert_id: 'plugin_upgraded',\n\t\t\t\t\ttitle: '[[admin/extend/plugins:alert.upgraded]]',\n\t\t\t\t\tmessage: '[[admin/extend/plugins:alert.upgrade-success]]',\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\tclickfn: function () {\n\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\n\t\t\t\t\t\t\tinstance.rebuildAndRestart();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tPlugins.toggleInstall = function (pluginID, version, callback) {\n\t\tvar btn = $('li[data-plugin-id=\"' + pluginID + '\"] button[data-action=\"toggleInstall\"]');\n\t\tbtn.find('i').attr('class', 'fa fa-refresh fa-spin');\n\n\t\tsocket.emit('admin.plugins.toggleInstall', {\n\t\t\tid: pluginID,\n\t\t\tversion: version,\n\t\t}, function (err, pluginData) {\n\t\t\tif (err) {\n\t\t\t\tbtn.removeAttr('disabled');\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tajaxify.refresh();\n\n\t\t\tapp.alert({\n\t\t\t\talert_id: 'plugin_toggled',\n\t\t\t\ttitle: '[[admin/extend/plugins:alert.' + (pluginData.installed ? 'installed' : 'uninstalled') + ']]',\n\t\t\t\tmessage: '[[admin/extend/plugins:alert.' + (pluginData.installed ? 'install-success' : 'uninstall-success') + ']]',\n\t\t\t\ttype: 'info',\n\t\t\t\ttimeout: 5000,\n\t\t\t});\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback.apply(this, arguments);\n\t\t\t}\n\t\t});\n\t};\n\n\tPlugins.suggest = function (pluginId, callback) {\n\t\tvar nbbVersion = app.config.version.match(/^\\d+\\.\\d+\\.\\d+/);\n\t\t$.ajax((app.config.registry || 'https://packages.nodebb.org') + '/api/v1/suggest', {\n\t\t\ttype: 'GET',\n\t\t\tdata: {\n\t\t\t\tpackage: pluginId,\n\t\t\t\tversion: nbbVersion[0],\n\t\t\t},\n\t\t\tdataType: 'json',\n\t\t}).done(function (payload) {\n\t\t\tcallback(undefined, payload);\n\t\t}).fail(callback);\n\t};\n\n\tfunction populateUpgradeablePlugins() {\n\t\t$('#installed ul li').each(function () {\n\t\t\tif ($(this).children('[data-action=\"upgrade\"]').length) {\n\t\t\t\t$('#upgrade ul').append($(this).clone(true));\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction populateActivePlugins() {\n\t\t$('#installed ul li').each(function () {\n\t\t\tif ($(this).hasClass('active')) {\n\t\t\t\t$('#active ul').append($(this).clone(true));\n\t\t\t} else {\n\t\t\t\t$('#deactive ul').append($(this).clone(true));\n\t\t\t}\n\t\t});\n\t}\n\n\treturn Plugins;\n});\n"]}